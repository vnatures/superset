"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2145],{62145:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R,getLayer:()=>T});var a=i(96540),o=i(95579),l=i(84402),n=i(18277),r=i(81729),s=i(82077),d=i(91018),c=i(98595),u=i(93559);const g=[0,0,0,255],h={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:g},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class p extends l.A{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&n.A.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),i=e.dataChanged.map((e=>(0,u.J)({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:i})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:i,positionFormat:a,_normalize:o}=this.props,l=[],n="XY"===a?2:3,{startRow:s,endRow:d}=e,{iterable:u,objectInfo:g}=(0,r.X)(t,s,d);for(const e of u){g.index++;let t=i(e,g);o&&(t=c.S8(t,n));const{holeIndices:a}=t,r=t.positions||t;if(a)for(let t=0;t<=a.length;t++){const i=r.slice(a[t-1]||0,a[t]||r.length);l.push(this.getSubLayerRow({path:i},e,g.index))}else l.push(this.getSubLayerRow({path:r},e,g.index))}return l}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:a,extruded:o,wireframe:l,_normalize:n,_windingOrder:r,elevationScale:c,transitions:u,positionFormat:h}=this.props,{lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:f,lineWidthMaxPixels:y,lineJointRounded:_,lineMiterLimit:b,lineDashJustified:v}=this.props,{getFillColor:C,getLineColor:L,getLineWidth:A,getLineDashArray:x,getElevation:S,getPolygon:w,updateTriggers:F,material:k}=this.props,{paths:P,pathsDiff:D}=this.state,W=this.getSubLayerClass("fill",s.A),T=this.getSubLayerClass("stroke",d.A),M=this.shouldRenderSubLayer("fill",P)&&new W({_dataDiff:t,extruded:o,elevationScale:c,filled:a,wireframe:l,_normalize:n,_windingOrder:r,getElevation:S,getFillColor:C,getLineColor:o&&l?L:g,material:k,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:F&&{getPolygon:F.getPolygon,getElevation:F.getElevation,getFillColor:F.getFillColor,lineColors:o&&l,getLineColor:F.getLineColor}}),{data:e,positionFormat:h,getPolygon:w});return[!o&&M,!o&&i&&this.shouldRenderSubLayer("stroke",P)&&new T({_dataDiff:D&&(()=>D),widthUnits:p,widthScale:m,widthMinPixels:f,widthMaxPixels:y,jointRounded:_,miterLimit:b,dashJustified:v,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(L),getWidth:this.getSubLayerAccessor(A),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:F&&{getWidth:F.getLineWidth,getColor:F.getLineColor,getDashArray:F.getLineDashArray}}),{data:P,positionFormat:h,getPath:e=>e.path}),o&&M]}}p.layerName="PolygonLayer",p.defaultProps=h;const m=p;var f=i(66671),y=i(32548),_=i(12619),b=i(62319),v=i(30885),C=i(69161),L=i(49443);const A=10;function x({break_points:e,num_buckets:t},i,a){if(!i)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):A,[o,l]=(0,_.extent)(i,a).map((e=>"string"==typeof e?parseFloat(e):e));if(void 0===o||void 0===l)return[];const n=(l-o)/e,r=0===n?0:Math.max(0,Math.ceil(Math.log10(1/n))),s=l>parseFloat(l.toFixed(r))?1:0,d=o<parseFloat(o.toFixed(r))?o-1:o;return new Array(e+1+s).fill(0).map(((e,t)=>(d+t*n).toFixed(r)))}return e.sort(((e,t)=>parseFloat(e)-parseFloat(t)))}function S({break_points:e,num_buckets:t,linear_color_scheme:i,opacity:a},o,l){const n=e||t?x({break_points:e,num_buckets:t},o,l):null,r=Array.isArray(i)?new v.A({colors:i,id:"custom"}):(0,C.A)().get(i);if(!r)return null;let s,d;if(null!==n){const e=n.length-1,t=e>1?r.getColors(e):[r.colors[r.colors.length-1]],i=t[0],a=t[t.length-1];t.unshift(i),t.push(a);const o=n.map(parseFloat);s=(0,b.A)().domain(o).range(t),d=t=>!!t&&(t>o[e]||t<o[0])}else{const e=(0,_.extent)(o,l);s=e.some((e=>"number"==typeof e))?r.createLinearScale((0,_.extent)(o,l)):r.createLinearScale(),d=()=>!1}return e=>{const t=l(e);if(!t)return[0,0,0,0];const i=(0,L.hexToRGB)(s(t));return d(t)?i[3]=0:i[3]=a/100*255,i}}var w=i(41857),F=i(25564);function k(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var P=i(95490),D=i(70957),W=i(2445);function T(e,t,i,a,l,n){const r=e,s=r.fill_color_picker,d=r.stroke_color_picker;let c=[...t.data.features];r.js_data_mutator&&(c=(0,F.A)(r.js_data_mutator)(c));const u=r.metric?r.metric.label||r.metric:null,g=null===r.metric?()=>[s.r,s.g,s.b,255*s.a]:S(r,c,(e=>e[u])),h=e=>{const t=(null==g?void 0:g(e))||[0,0,0,0];return l.length>0&&!l.includes(e[r.line_column])&&(t[3]/=2),t},p=r.line_column&&r.metric&&["json","geohash","zipcode"].includes(r.line_type)?function(e){return t=>{var i,a,l,n;const r=(null==e||null==(i=e.metric)?void 0:i.label)||(null==e?void 0:e.metric);return(0,W.FD)("div",{className:"deckgl-tooltip",children:[(null==(a=t.object)?void 0:a.name)&&(0,W.Y)(y.A,{label:(0,o.t)("name")+": ",value:`${t.object.name}`}),(null==(l=t.object)?void 0:l[null==e?void 0:e.line_column])&&(0,W.Y)(y.A,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),(null==e?void 0:e.metric)&&(0,W.Y)(y.A,{label:`${r}: `,value:`${null==(n=t.object)?void 0:n[r]}`})]})}}(r):()=>null;return new m({id:`path-layer-${r.slice_id}`,data:c,filled:r.filled,stroked:r.stroked,getPolygon:k,getFillColor:h,getLineColor:[d.r,d.g,d.b,255*d.a],getLineWidth:r.line_width,extruded:r.extruded,lineWidthUnits:r.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h),elevationScale:r.multiplier,fp64:!0,...(0,w.T)(r,a,p,n)})}const M=e=>{const t=(0,a.useRef)(),i=(0,a.useCallback)((()=>{let t={...e.viewport};if(e.formData.autozoom){const i=e.payload.data.features||[];t=(0,P.A)(t,{width:e.width,height:e.height,points:i.flatMap(k)})}return t.zoom<0&&(t.zoom=0),t}),[e]),[o,l]=(0,a.useState)(0),[n,r]=(0,a.useState)(i()),[s,d]=(0,a.useState)(e.payload.form_data),[c,u]=(0,a.useState)([]);(0,a.useEffect)((()=>{const{payload:t}=e;t.form_data!==s&&(r(i()),u([]),l(0),d(t.form_data))}),[i,e,s,n]);const g=(0,a.useCallback)((e=>{const{current:i}=t;i&&i.setTooltip(e)}),[]),h=(0,a.useCallback)((t=>{const{formData:i,onAddFilter:a}=e,n=(new Date).getDate(),r=n-o<=250,s=[...c];if(r)s.splice(0,s.length,t);else if(i.toggle_polygons){const e=s.indexOf(t);-1===e?s.push(t):s.splice(e,1)}else s.splice(0,1,t);u(s),l(n),i.table_filter&&a(i.line_column,c,!1,!0)}),[o,e,c]),p=(0,a.useCallback)((()=>void 0===e.payload.data.features?[]:[T(e.formData,e.payload,e.onAddFilter,g,c,h)]),[h,e.formData,e.onAddFilter,e.payload,c,g]),{payload:m,formData:y,setControlValue:_}=e,b=y.metric?y.metric.label||y.metric:null,v=function(e,t,i){const a=x(e,t,i),o=S(e,t,i),l={};return a.slice(1).forEach(((t,i)=>{const n=`${a[i]} - ${a[i+1]}`,r=.5*(parseFloat(a[i])+parseFloat(a[i+1])),s=e.metric?e.metric.label||e.metric:null;l[n]={color:null==o?void 0:o({[s||e.metric]:r}),enabled:!0}})),l}(y,m.data.features,(e=>e[b]));return(0,W.FD)("div",{style:{position:"relative"},children:[(0,W.Y)(D.S,{ref:t,viewport:n,layers:p(),setControlValue:_,mapStyle:y.mapbox_style,mapboxApiAccessToken:m.data.mapboxApiKey,width:e.width,height:e.height}),null!==y.metric&&(0,W.Y)(f.A,{categories:v,position:y.legend_position,format:y.legend_format})]})},R=(0,a.memo)(M)}}]);