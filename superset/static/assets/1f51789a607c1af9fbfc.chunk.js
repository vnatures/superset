"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5721],{13686:(e,t,n)=>{n.d(t,{t:()=>f});var r=n(77189);const s=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,a=String.raw`(?:TODAY|NOW)`,i=String.raw`[+-]?[1-9][0-9]*`,l=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,o=RegExp(String.raw`^DATEADD\(DATETIME\("(${s}|${a})"\),\s(${i}),\s(${l})\)$`,"i"),c=RegExp(String.raw`^${s}$|^${a}$`,"i"),u=["now","today"],d=new Date;d.setHours(0,0,0,0);const g=new Date;g.setHours(0,0,0,0);const m={sinceDatetime:d.setDate(d.getDate()-7).toString(),sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:g.toString(),untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},f=e=>{const t=e.split(r.wv);if(2===t.length){const[e,n]=t;if(c.test(e)&&c.test(n)){const t=u.includes(e)?e:"specific",r=u.includes(n)?n:"specific";return{customRange:{...m,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:r},matchedFlag:!0}}const r=e.match(o);if(r&&c.test(n)&&e.includes(n)){const[e,t,s]=r.slice(1),a=u.includes(n)?n:"specific";return{customRange:{...m,sinceGrain:s,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:a},matchedFlag:!0}}const s=n.match(o);if(c.test(e)&&s&&n.includes(e)){const[t,n,r]=[...s.slice(1)],a=u.includes(e)?e:"specific";return{customRange:{...m,untilGrain:r,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:a},matchedFlag:!0}}if(r&&s){const[e,t,n]=[...r.slice(1)],[a,i,l]=[...s.slice(1)];if(e===a)return{customRange:{...m,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(i,10),untilDatetime:a,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:m,matchedFlag:!1}}},49277:(e,t,n)=>{n.d(t,{M9:()=>c,TX:()=>u,cy:()=>o});var r=n(62193),s=n.n(r),a=n(62952),i=n(13686);const l=864e5,o=(e,t=!1,n=!1)=>{const r=new Date;if("now"===e||"No filter"===e||""===e)return r;if("today"===e)return r.setHours(0,0,0,0),r;if(n?r.setHours(-r.getTimezoneOffset()/60,0,0,0):r.setHours(0,0,0,0),t&&null!=e&&e.includes("Last"))return r;switch(e){case"Last day":return r.setUTCDate(r.getUTCDate()-1),r;case"Last week":return r.setUTCDate(r.getUTCDate()-7),r;case"Last month":return r.setUTCMonth(r.getUTCMonth()-1),r;case"Last quarter":return r.setUTCMonth(r.getUTCMonth()-3),r;case"Last year":return r.setUTCFullYear(r.getUTCFullYear()-1),r;case"previous calendar week":return t?r.setDate(r.getDate()-r.getDay()+1):r.setDate(r.getDate()-r.getDay()-6),r;case"previous calendar month":return t?r.setDate(1):(r.setDate(1),r.setMonth(r.getMonth()-1)),r;case"previous calendar year":return t?r.setFullYear(r.getFullYear(),0,1):r.setFullYear(r.getFullYear()-1,0,1),r}if(null!=e&&e.includes("ago")){const t=e.split(" "),n=parseInt(t[0],10);switch(t[1]){case"day":case"days":r.setUTCDate(r.getUTCDate()-n);break;case"week":case"weeks":r.setUTCDate(r.getUTCDate()-7*n);break;case"month":case"months":r.setUTCMonth(r.getUTCMonth()-n);break;case"year":case"years":r.setUTCFullYear(r.getUTCFullYear()-n)}return r}const a=null==e?void 0:e.split("-");let i=null;return i=a&&!s()(a)?1===a.length?new Date(Date.UTC(parseInt(a[0],10),0)):2===a.length?new Date(Date.UTC(parseInt(a[0],10),parseInt(a[1],10)-1)):3===a.length?new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)):new Date(e):new Date(e),i&&!Number.isNaN(i.getTime())?(n?i.setHours(-i.getTimezoneOffset()/60,0,0,0):i.setHours(0,0,0,0),i):null},c=(e,t,n)=>{let r;if(r="now"===e||"today"===e?new Date:new Date(e),!Number.isNaN(r.getTime())){switch(t){case"second":r.setSeconds(r.getSeconds()+n);break;case"minute":r.setMinutes(r.getMinutes()+n);break;case"hour":r.setHours(r.getHours()+n);break;case"day":r.setDate(r.getDate()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"year":r.setFullYear(r.getFullYear()+n)}return r}return null},u=({timeRangeFilter:e,shifts:t,startDate:n,includeFutureOffsets:r=!0})=>{var s,u,d,g,m,f;const{customRange:h,matchedFlag:p}=(0,i.t)(null!=(s=null==e?void 0:e.comparator)?s:"");let D=null,v=null;if(p){var w,b;const{sinceDatetime:e,sinceMode:t,sinceGrain:n,sinceGrainValue:r,untilDatetime:s,untilMode:a,untilGrain:i,untilGrainValue:l}={...h};D="relative"!==t?"specific"===t?new Date(e):o(e,!1,!0):c(e,n,r),null==(w=D)||w.setHours(0,0,0,0),v="relative"!==a?"specific"===a?new Date(s):o(s,!1,!0):c(s,i,l),null==(b=v)||b.setHours(0,0,0,0)}const y=null==t?void 0:t.includes("custom"),T=null==t?void 0:t.includes("inherit");let $;var x;y&&($=p?new Date(new Date(n).setUTCHours(new Date(n).getTimezoneOffset()/60,0,0,0)).getTime():null==(x=o(n))?void 0:x.getTime());const[C,M]=(null!=(u=null==e?void 0:e.comparator)?u:"").split(" : ").map((e=>e.trim())),U=(null==(d=null!=(g=D)?g:o(C,!1,!1))?void 0:d.getTime())||0,F=(null==(m=null!=(f=v)?f:o(M||C,!0,!1))?void 0:m.getTime())||0,R=$&&U&&Math.round((U-$)/l),k=T&&F&&U&&Math.round((F-U)/l),A=(0,a.A)(t).map((e=>{if("custom"===e&&void 0!==R&&!Number.isNaN(R)){if(r&&R<0)return-1*R+" days after";if(R>=0&&U)return`${R} days ago`}if("inherit"===e&&k&&!Number.isNaN(k)){if(r&&k<0)return-1*k+" days after";if(k>0)return`${k} days ago`}return e})).filter((e=>"custom"!==e&&"inherit"!==e));return(0,a.A)(A)}},55721:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(62193),s=n.n(r),a=n(96540),i=n(96453),l=n(77189),o=n(49277),c=n(62952),u=n(17437),d=n(95579),g=n(42370),m=n(97689),f=n(45186),h=n(38221),p=n.n(h);const D=e=>{const t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{let r;const a=t.current,i=n.current;if(a&&i){const t=Array.from(a.children);r=new ResizeObserver(p()((()=>{t.reduce(((e,t)=>{var n,r;return e+(null!=(n=null==(r=t.firstElementChild)?void 0:r.scrollWidth)?n:0)}),0)+e*Math.max(t.length-1,0)>i.clientWidth?s(!0):s(!1)}),500)),r.observe(document.body),t.forEach((e=>{r.observe(e)}))}return()=>{var e;return null==(e=r)?void 0:e.disconnect()}}),[e]),{isOverflowing:r,symbolContainerRef:t,wrapperRef:n}};var v=n(2445);const w=i.I4.div`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 100%;
  overflow: auto;
`,b=i.I4.div`
  ${({theme:e,subheaderFontSize:t})=>`\n    font-weight: ${e.typography.weights.light};\n    display: flex;\n    justify-content: center;\n    font-size: ${t||20}px;\n    flex: 1 1 0px;\n  `}
`,y=i.I4.span`
  ${({theme:e,backgroundColor:t,textColor:n})=>`\n    background-color: ${t};\n    color: ${n};\n    padding: ${e.gridUnit}px ${2*e.gridUnit}px;\n    border-radius: ${2*e.gridUnit}px;\n    margin-right: ${e.gridUnit}px;\n  `}
`;function T(e){const{height:t,width:n,bigNumber:r,prevNumber:h,valueDifference:p,percentDifferenceFormattedString:T,headerFontSize:$,subheaderFontSize:x,comparisonColorEnabled:C,comparisonColorScheme:M,percentDifferenceNumber:U,currentTimeRangeFilter:F,startDateOffset:R,shift:k,dashboardTimeRange:A}=e,[H,N]=(0,a.useState)("");(0,a.useEffect)((()=>{if(F&&(k||R)){if(!s()(k)||R){const e=(0,l.x9)(null!=A?A:F.comparator,F.subject);Promise.resolve(e).then((e=>{var t;const n=null==e||null==(t=e.value)?void 0:t.match(g.Io),[r,s]=null!=n?n:[],a=(0,o.TX)({timeRangeFilter:{...F,comparator:`${r} : ${s}`},shifts:(0,c.A)(k),startDate:R||""});(0,l.x9)(null!=A?A:F.comparator,F.subject,(0,c.A)(a)).then((e=>{const t=(0,c.A)(e.value).flat()[0].split("vs\n");N(t.length>1?t[1].trim():t[0])}))}))}}else N("")}),[F,k,R,A]);const S=(0,i.DP)(),G=5*S.gridUnit,Y=u.AH`
    font-family: ${S.typography.families.sansSerif};
    display: flex;
    justify-content: center;
    align-items: center;
    height: ${t}px;
    width: ${n}px;
    overflow: auto;
  `,I=u.AH`
    font-size: ${$||60}px;
    font-weight: ${S.typography.weights.normal};
    text-align: center;
    margin-bottom: ${4*S.gridUnit}px;
  `,E=u.AH`
    color: ${C&&0!==U?U>0?M===f.m.Green?S.colors.success.base:S.colors.error.base:M===f.m.Red?S.colors.success.base:S.colors.error.base:S.colors.grayscale.base};
    margin-left: ${S.gridUnit}px;
  `,O=S.colors.grayscale.light4,V=S.colors.grayscale.base,{backgroundColor:z,textColor:j}=(0,a.useMemo)((()=>{let e=O,t=V;if(C&&0!==U){const n=U>0&&M===f.m.Green||U<0&&M===f.m.Red;e=n?S.colors.success.light2:S.colors.error.light2,t=n?S.colors.success.base:S.colors.error.base}return{backgroundColor:e,textColor:t}}),[S,M,C,U]),L=(0,a.useMemo)((()=>[{symbol:"#",value:h,tooltipText:(0,d.t)("Data for %s",H||"previous range")},{symbol:"△",value:p,tooltipText:(0,d.t)("Value difference between the time periods")},{symbol:"%",value:T,tooltipText:(0,d.t)("Percentage difference between the time periods")}]),[H,h,p,T]),{isOverflowing:q,symbolContainerRef:W,wrapperRef:_}=D(G);return(0,v.Y)("div",{css:Y,ref:_,children:(0,v.FD)(w,{css:q&&u.AH`
            width: fit-content;
            margin: auto;
            align-items: flex-start;
          `,children:[(0,v.FD)("div",{css:I,children:[r,0!==U&&(0,v.Y)("span",{css:E,children:U>0?"↑":"↓"})]}),(0,v.Y)("div",{css:[u.AH`
              display: flex;
              justify-content: space-around;
              gap: ${G}px;
              min-width: 0;
              flex-shrink: 1;
            `,q?u.AH`
                  flex-direction: column;
                  align-items: flex-start;
                  width: fit-content;
                `:u.AH`
                  align-items: center;
                  width: 100%;
                `,"",""],ref:W,children:L.map(((e,t)=>(0,v.Y)(b,{subheaderFontSize:x,children:(0,v.FD)(m.m,{id:"tooltip",placement:"top",title:e.tooltipText,children:[(0,v.Y)(y,{backgroundColor:t>0?z:O,textColor:t>0?j:V,children:e.symbol}),e.value]})},`comparison-symbol-${e.symbol}`)))})]})})}},77189:(e,t,n)=>{n.d(t,{wv:()=>u,x9:()=>f});var r=n(62193),s=n.n(r),a=n(58561),i=n.n(a),l=n(62952),o=n(35742),c=n(51436);const u=" : ",d=(e,t)=>`${e}${u}${t}`,g=(e,t)=>e.replace("T00:00:00","")||(t?"-∞":"∞"),m=(e,t="col")=>{const n=e.split(u);return 1===n.length?e:`${g(n[0],!0)} ≤ ${t} < ${g(n[1])}`},f=async(e,t="col",n)=>{let r,a;if(s()(n))r=i().encode_uri(e),a=`/api/v1/time_range/?q=${r}`;else{const t=(0,l.A)(n).map((t=>({timeRange:e,shift:t})));r=i().encode_uri([{timeRange:e},...t]),a=`/api/v1/time_range/?q=${r}`}try{var f;const e=await o.A.get({endpoint:a});if(s()(n)){var h,p,D,v;const n=d((null==e||null==(h=e.json)||null==(p=h.result[0])?void 0:p.since)||"",(null==e||null==(D=e.json)||null==(v=D.result[0])?void 0:v.until)||"");return{value:m(n,t)}}const r=null==e||null==(f=e.json)?void 0:f.result.map((e=>d(e.since,e.until)));return{value:r.slice(1).map((e=>((e,t,n="col")=>{const r=e.split(u),s=t.split(u);return`${n}: ${g(r[0],!0)} to ${g(r[1])} vs\n  ${g(s[0],!0)} to ${g(s[1])}`})(r[0],e,t)))}}catch(e){const t=await(0,c.h4)(e);return{error:t.message||t.error||e.statusText}}}}}]);