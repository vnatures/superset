"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2077],{66570:e=>{function t(e,t,o){o=o||2;var r,s,a,l,c,d,f,v=t&&t.length,g=v?t[0]*o:e.length,h=n(e,0,g,o,!0),y=[];if(!h||h.next===h.prev)return y;if(v&&(h=function(e,t,o,i){var r,s,a,l=[];for(r=0,s=t.length;r<s;r++)(a=n(e,t[r]*i,r<s-1?t[r+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),l.push(x(a));for(l.sort(u),r=0;r<l.length;r++)o=p(l[r],o);return o}(e,t,h,o)),e.length>80*o){r=a=e[0],s=l=e[1];for(var m=o;m<g;m+=o)(c=e[m])<r&&(r=c),(d=e[m+1])<s&&(s=d),c>a&&(a=c),d>l&&(l=d);f=0!==(f=Math.max(a-r,l-s))?32767/f:0}return i(h,y,o,r,s,f,0),y}function n(e,t,n,o,i){var r,s;if(i===b(e,t,n,o)>0)for(r=t;r<n;r+=o)s=C(r,e[r],e[r+1],s);else for(r=n-o;r>=t;r-=o)s=C(r,e[r],e[r+1],s);return s&&h(s,s.next)&&(S(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var n,o=e;do{if(n=!1,o.steiner||!h(o,o.next)&&0!==g(o.prev,o,o.next))o=o.next;else{if(S(o),(o=t=o.prev)===o.next)break;n=!0}}while(n||o!==t);return t}function i(e,t,n,u,p,c,x){if(e){!x&&c&&function(e,t,n,o){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,o)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,o,i,r,s,a,l,u=1;do{for(n=e,e=null,r=null,s=0;n;){for(s++,o=n,a=0,t=0;t<u&&(a++,o=o.nextZ);t++);for(l=u;a>0||l>0&&o;)0!==a&&(0===l||!o||n.z<=o.z)?(i=n,n=n.nextZ,a--):(i=o,o=o.nextZ,l--),r?r.nextZ=i:e=i,i.prevZ=r,r=i;n=o}r.nextZ=null,u*=2}while(s>1)}(i)}(e,u,p,c);for(var f,v,g=e;e.prev!==e.next;)if(f=e.prev,v=e.next,c?s(e,u,p,c):r(e))t.push(f.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),S(e),e=v.next,g=v.next;else if((e=v)===g){x?1===x?i(e=a(o(e),t,n),t,n,u,p,c,2):2===x&&l(e,t,n,u,p,c):i(o(e),t,n,u,p,c,1);break}}}function r(e){var t=e.prev,n=e,o=e.next;if(g(t,n,o)>=0)return!1;for(var i=t.x,r=n.x,s=o.x,a=t.y,l=n.y,u=o.y,p=i<r?i<s?i:s:r<s?r:s,c=a<l?a<u?a:u:l<u?l:u,d=i>r?i>s?i:s:r>s?r:s,x=a>l?a>u?a:u:l>u?l:u,v=o.next;v!==t;){if(v.x>=p&&v.x<=d&&v.y>=c&&v.y<=x&&f(i,a,r,l,s,u,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function s(e,t,n,o){var i=e.prev,r=e,s=e.next;if(g(i,r,s)>=0)return!1;for(var a=i.x,l=r.x,u=s.x,p=i.y,c=r.y,x=s.y,v=a<l?a<u?a:u:l<u?l:u,h=p<c?p<x?p:x:c<x?c:x,y=a>l?a>u?a:u:l>u?l:u,m=p>c?p>x?p:x:c>x?c:x,P=d(v,h,t,n,o),w=d(y,m,t,n,o),_=e.prevZ,C=e.nextZ;_&&_.z>=P&&C&&C.z<=w;){if(_.x>=v&&_.x<=y&&_.y>=h&&_.y<=m&&_!==i&&_!==s&&f(a,p,l,c,u,x,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,C.x>=v&&C.x<=y&&C.y>=h&&C.y<=m&&C!==i&&C!==s&&f(a,p,l,c,u,x,C.x,C.y)&&g(C.prev,C,C.next)>=0)return!1;C=C.nextZ}for(;_&&_.z>=P;){if(_.x>=v&&_.x<=y&&_.y>=h&&_.y<=m&&_!==i&&_!==s&&f(a,p,l,c,u,x,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;C&&C.z<=w;){if(C.x>=v&&C.x<=y&&C.y>=h&&C.y<=m&&C!==i&&C!==s&&f(a,p,l,c,u,x,C.x,C.y)&&g(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function a(e,t,n){var i=e;do{var r=i.prev,s=i.next.next;!h(r,s)&&y(r,i,i.next,s)&&w(r,s)&&w(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),S(i),S(i.next),i=e=s),i=i.next}while(i!==e);return o(i)}function l(e,t,n,r,s,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var p=_(l,u);return l=o(l,l.next),p=o(p,p.next),i(l,t,n,r,s,a,0),void i(p,t,n,r,s,a,0)}u=u.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function p(e,t){var n=function(e,t){var n,o=t,i=e.x,r=e.y,s=-1/0;do{if(r<=o.y&&r>=o.next.y&&o.next.y!==o.y){var a=o.x+(r-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(a<=i&&a>s&&(s=a,n=o.x<o.next.x?o:o.next,a===i))return n}o=o.next}while(o!==t);if(!n)return null;var l,u=n,p=n.x,d=n.y,x=1/0;o=n;do{i>=o.x&&o.x>=p&&i!==o.x&&f(r<d?i:s,r,p,d,r<d?s:i,r,o.x,o.y)&&(l=Math.abs(r-o.y)/(i-o.x),w(o,e)&&(l<x||l===x&&(o.x>n.x||o.x===n.x&&c(n,o)))&&(n=o,x=l)),o=o.next}while(o!==u);return n}(e,t);if(!n)return t;var i=_(n,e);return o(i,i.next),o(n,n.next)}function c(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,o,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,o,i,r,s,a){return(i-s)*(t-a)>=(e-s)*(r-a)&&(e-s)*(o-a)>=(n-s)*(t-a)&&(n-s)*(r-a)>=(i-s)*(o-a)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var n=e,o=!1,i=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&i<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next}while(n!==e);return o}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||h(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function h(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,o){var i=P(g(e,t,n)),r=P(g(e,t,o)),s=P(g(n,o,e)),a=P(g(n,o,t));return i!==r&&s!==a||!(0!==i||!m(e,n,t))||!(0!==r||!m(e,o,t))||!(0!==s||!m(n,e,o))||!(0!==a||!m(n,t,o))}function m(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function P(e){return e>0?1:e<0?-1:0}function w(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function _(e,t){var n=new L(e.i,e.x,e.y),o=new L(t.i,t.x,t.y),i=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,o.next=n,n.prev=o,r.next=o,o.prev=r,o}function C(e,t,n,o){var i=new L(e,t,n);return o?(i.next=o.next,i.prev=o,o.next.prev=i,o.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function L(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function b(e,t,n,o){for(var i=0,r=t,s=n-o;r<n;r+=o)i+=(e[s]-e[r])*(e[r+1]+e[s+1]),s=r;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,o){var i=t&&t.length,r=i?t[0]*n:e.length,s=Math.abs(b(e,0,r,n));if(i)for(var a=0,l=t.length;a<l;a++){var u=t[a]*n,p=a<l-1?t[a+1]*n:e.length;s-=Math.abs(b(e,u,p,n))}var c=0;for(a=0;a<o.length;a+=3){var d=o[a]*n,x=o[a+1]*n,f=o[a+2]*n;c+=Math.abs((e[d]-e[f])*(e[x+1]-e[d+1])-(e[d]-e[x])*(e[f+1]-e[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},o=0,i=0;i<e.length;i++){for(var r=0;r<e[i].length;r++)for(var s=0;s<t;s++)n.vertices.push(e[i][r][s]);i>0&&(o+=e[i-1].length,n.holes.push(o))}return n}},82077:(e,t,n)=>{n.d(t,{A:()=>S});var o=n(75077),i=n(82101),r=n(23197),s=n(16704),a=n(77117),l=n(83391),u=n(22986),p=n(98595),c=n(90203),d=n(82050);class x extends c.A{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=p.S8(e,this.positionSize);return this.opts.resolution?(0,d.wk)(p.Dt(t),p.A4(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?(0,d.Eg)(p.Dt(t),p.A4(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(f(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return p.Dt(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&f(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:o}){const{attributes:i,indexStarts:r,typedArrayManager:s}=this;let a=i.indices;if(!a||!e)return;let l=o;const u=p.$q(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=s.allocate(a,o+u.length,{copy:!0});for(let e=0;e<u.length;e++)a[l++]=u[e]+n;r[t+1]=o+u.length,i.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:o},positionSize:i}=this;if(!o||!e)return;const r=p.Dt(e);for(let e=t,s=0;s<n;e++,s++){const t=r[s*i],n=r[s*i+1],a=i>2?r[s*i+2]:0;o[3*e]=t,o[3*e+1]=n,o[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:o}=this,i=this.attributes.vertexValid,r=e&&p.A4(e);if(e&&e.edgeTypes?i.set(e.edgeTypes,t):i.fill(1,t,t+n),r)for(let e=0;e<r.length;e++)i[t+r[e]/o-1]=0;i[t+n-1]=0}}function f(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const v="uniform solidPolygonUniforms {\n  bool extruded;\n  bool isWireframe;\n  float elevationScale;\n} solidPolygon;\n",g={name:"solidPolygon",vs:v,fs:v,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},h="in vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project.commonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (solidPolygon.extruded) {\npos.z += props.elevations * solidPolygon.elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (solidPolygon.extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * layer.opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",y=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${h}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,m=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${h}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,P=[0,0,0,255],w={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:P},getLineColor:{type:"accessor",value:P},material:!0},_={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class C extends o.A{getShaders(e){return super.getShaders({vs:"top"===e?y:m,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[i.A,u.J,r.A,g]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let o;e.isGeospatial&&t===s.rf.DEFAULT&&(t=s.rf.LNGLAT),t===s.rf.LNGLAT&&(o=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new x({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const i=this.getAttributeManager(),r=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:r},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:_,accessor:"getPolygon",update:this.calculatePositions,noAlloc:r,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:r},elevations:{size:1,stepMode:"dynamic",transition:_,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:_,accessor:"getFillColor",defaultValue:P},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:_,accessor:"getLineColor",defaultValue:P},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:o,elevationScale:i}=this.props,{topModel:r,sideModel:s,wireframeModel:a,polygonTesselator:l}=this.state,u={extruded:Boolean(t),elevationScale:i,isWireframe:!1};a&&o&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:{...u,isWireframe:!0}}),a.draw(this.context.renderPass)),s&&n&&(s.setInstanceCount(l.instanceCount-1),s.shaderInputs.setProps({solidPolygon:u}),s.draw(this.context.renderPass)),r&&n&&(r.setVertexCount(l.vertexCount),r.shaderInputs.setProps({solidPolygon:u}),r.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:o}=e,i=this.getAttributeManager();(o.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(this.state.models?.forEach((e=>e.destroy())),this.setState(this._getModels()),i.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,o=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let o,i,r;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new a.K(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});i=new a.K(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,geometry:new l.V({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),r=new a.K(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,geometry:new l.V({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[i,r,o].filter(Boolean),topModel:o,sideModel:i,wireframeModel:r}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}C.defaultProps=w,C.layerName="SolidPolygonLayer";const S=C},98595:(e,t,n)=>{n.d(t,{$q:()=>v,A4:()=>u,Dt:()=>l,S8:()=>d});var o=n(66570),i=n(82050);const r=i.rJ.CLOCKWISE,s=i.rJ.COUNTER_CLOCKWISE,a={isClosed:!0};function l(e){return"positions"in e?e.positions:e}function u(e){return"holeIndices"in e?e.holeIndices:null}function p(e,t,n,o,r){let s=t;const l=n.length;for(let t=0;t<l;t++)for(let i=0;i<o;i++)e[s++]=n[t][i]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let t=0;t<o;t++)e[s++]=n[0][t]||0;return a.start=t,a.end=s,a.size=o,(0,i.UD)(e,r,a),s}function c(e,t,n,o,r=0,s,l){const u=(s=s||n.length)-r;if(u<=0)return t;let p=t;for(let t=0;t<u;t++)e[p++]=n[r+t];if(!function(e,t,n,o){for(let i=0;i<t;i++)if(e[n+i]!==e[o-t+i])return!1;return!0}(n,o,r,s))for(let t=0;t<o;t++)e[p++]=n[r+t];return a.start=t,a.end=p,a.size=o,(0,i.UD)(e,l,a),p}function d(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],o=[];if("positions"in e){const{positions:i,holeIndices:a}=e;if(a){let e=0;for(let l=0;l<=a.length;l++)e=c(n,e,i,t,a[l-1],a[l],0===l?r:s),o.push(e);return o.pop(),{positions:n,holeIndices:o}}e=i}if(!function(e){return Array.isArray(e[0])}(e))return c(n,0,e,t,0,n.length,r),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let i=0;for(const[a,l]of e.entries())i=p(n,i,l,t,0===a?r:s),o.push(i);return o.pop(),{positions:n,holeIndices:o}}return p(n,0,e,t,r),n}function x(e,t,n){const o=e.length/3;let i=0;for(let r=0;r<o;r++){const s=(r+1)%o;i+=e[3*r+t]*e[3*s+n],i-=e[3*s+t]*e[3*r+n]}return Math.abs(i/2)}function f(e,t,n,o){const i=e.length/3;for(let r=0;r<i;r++){const i=3*r,s=e[i+0],a=e[i+1],l=e[i+2];e[i+t]=s,e[i+n]=a,e[i+o]=l}}function v(e,t,n,i){let r=u(e);r&&(r=r.map((e=>e/t)));let s=l(e);const a=i&&3===t;if(n){const e=s.length;s=s.slice();const o=[];for(let i=0;i<e;i+=t){o[0]=s[i],o[1]=s[i+1],a&&(o[2]=s[i+2]);const e=n(o);s[i]=e[0],s[i+1]=e[1],a&&(s[i+2]=e[2])}}if(a){const e=x(s,0,1),t=x(s,0,2),o=x(s,1,2);if(!e&&!t&&!o)return[];e>t&&e>o||(t>o?(n||(s=s.slice()),f(s,0,2,1)):(n||(s=s.slice()),f(s,2,0,1)))}return o(s,r,t)}}}]);