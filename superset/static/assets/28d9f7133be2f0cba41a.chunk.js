"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[6833],{7113:(t,e,i)=>{i.r(e),i.d(e,{default:()=>_e});var s=i(96540),r=i(96453),n=i(7889),o=i(38221),a=i.n(o),h=i(44294),l=i(11854),c=i(27083),u=i(86717),d=i(6837),g=i(27430),m=i(70915),p=i(9438);class f extends g.A{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(p.JH),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push((0,p.KT)(this.geometries_[t],d.A.CHANGE,this.changed,this))}clone(){const t=new f(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<(0,m.Ld)(this.getExtent(),t,e))return s;const r=this.geometries_;for(let n=0,o=r.length;n<o;++n)s=r[n].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){(0,m.aZ)(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)(0,m.X$)(t,e[i].getExtent());return t}getGeometries(){return _(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let r=0,n=i.length;r<n;++r){const n=i[r],o=n.getSimplifiedGeometry(t);e.push(o),o!==n&&(s=!0)}if(s){const t=new f(null);return t.setGeometriesArray(e),t}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=(0,m.q1)(this.getExtent()));const s=this.geometries_;for(let r=0,n=s.length;r<n;++r)s[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(_(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function _(t){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone());return e}const T=f;var C=i(4087);const x=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?(0,c.Jt)(e.dataProjection):this.readProjection(t);e.extent&&i&&"tile-pixels"===i.getUnits()&&(i=(0,c.Jt)(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return(0,C.b0)()}readFeature(t,e){return(0,C.b0)()}readFeatures(t,e){return(0,C.b0)()}readGeometry(t,e){return(0,C.b0)()}readProjection(t){return(0,C.b0)()}writeFeature(t,e){return(0,C.b0)()}writeFeatures(t,e){return(0,C.b0)()}writeGeometry(t,e){return(0,C.b0)()}};function y(t,e,i){const s=i?(0,c.Jt)(i.featureProjection):null,r=i?(0,c.Jt)(i.dataProjection):null;let n;if(n=s&&r&&!(0,c.tI)(s,r)?(e?t.clone():t).transform(e?s:r,e?r:s):t,e&&i&&void 0!==i.decimals){const e=Math.pow(10,i.decimals),s=function(t){for(let i=0,s=t.length;i<s;++i)t[i]=Math.round(t[i]*e)/e;return t};n===t&&(n=t.clone()),n.applyTransform(s)}return n}function E(t){if("string"==typeof t){return JSON.parse(t)||null}return null!==t?t:null}const v=class extends x{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(E(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(E(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return(0,C.b0)()}readFeaturesFromObject(t,e){return(0,C.b0)()}readGeometry(t,e){return this.readGeometryFromObject(E(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return(0,C.b0)()}readProjection(t){return this.readProjectionFromObject(E(t))}readProjectionFromObject(t){return(0,C.b0)()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return(0,C.b0)()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return(0,C.b0)()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return(0,C.b0)()}};var F=i(11217),S=i(62096),P=i(63953),R=i(92497),w=i(83671),j=i(66514),A=i(56361),b=i(79969),G=i(4350);class O extends S.Ay{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let e=this.getLayout();const i=t,s=[],r=[];for(let t=0,n=i.length;t<n;++t){const n=i[t];0===t&&(e=n.getLayout()),(0,j.X$)(s,n.getFlatCoordinates()),r.push(s.length)}this.setFlatCoordinates(e,s),this.ends_=r}}appendLineString(t){this.flatCoordinates?(0,j.X$)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new O(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<(0,m.Ld)(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,P.HX)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,P.oW)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(e=void 0!==e&&e,i=void 0!==i&&i,(0,b.L8)(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return(0,A.cD)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new F.default(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let r=0;for(let n=0,o=e.length;n<o;++n){const o=e[n],a=new F.default(t.slice(r,o),i);s.push(a),r=o}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let n=0,o=s.length;n<o;++n){const o=s[n],a=(0,b.SH)(e,i,o,r,.5);(0,j.X$)(t,a),i=o}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=(0,w.AL)(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new O(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return(0,G.fB)(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,R.KG)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const M=O;var I=i(61597);class z extends S.Ay{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?(0,j.X$)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new z(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<(0,m.Ld)(this.getExtent(),t,e))return s;const r=this.flatCoordinates,n=this.stride;for(let o=0,a=r.length;o<a;o+=n){const a=(0,I.hG)(t,e,r[o],r[o+1]);if(a<s){s=a;for(let t=0;t<n;++t)i[t]=r[o+t];i.length=n}}return s}getCoordinates(){return(0,A.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new h.default(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let r=0,n=t.length;r<n;r+=i){const n=new h.default(t.slice(r,r+i),e);s.push(n)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,r=e.length;s<r;s+=i){const i=e[s],r=e[s+1];if((0,m.Rj)(t,i,r))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,R.z2)(this.flatCoordinates,0,t,this.stride),this.changed()}}const L=z;var Y=i(48683),k=i(22616),X=i(83402),D=i(28609),Z=i(52845);class U extends S.Ay{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let s=this.getLayout();const r=t,n=[],o=[];for(let t=0,e=r.length;t<e;++t){const e=r[t];0===t&&(s=e.getLayout());const i=n.length,a=e.getEnds();for(let t=0,e=a.length;t<e;++t)a[t]+=i;(0,j.X$)(n,e.getFlatCoordinates()),o.push(a)}e=s,t=n,i=o}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;(0,j.X$)(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,s=e.length;t<s;++t)e[t]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const i=new U(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<(0,m.Ld)(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,P.c)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,P.te)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return(0,Z.Gd)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return(0,D.Cs)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),(0,X.NK)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,(0,A.Dz)(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=function(t,e,i,s){const r=[];let n=(0,m.S5)();for(let o=0,a=i.length;o<a;++o){const a=i[o];n=(0,m.Vy)(t,e,a[0],s),r.push((n[0]+n[2])/2,(n[1]+n[3])/2),e=a[a.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,k.p)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new L(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;(0,X.mb)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=(0,X.NK)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=(0,w.sx)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new U(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const i=this.endss_[t-1];e=i[i.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(0!==e)for(let t=0,s=i.length;t<s;++t)i[t]-=e;return new Y.default(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let n=0,o=i.length;n<o;++n){const o=i[n].slice(),a=o[o.length-1];if(0!==r)for(let t=0,e=o.length;t<e;++t)o[t]-=r;const h=new Y.default(e.slice(r,a),t,o);s.push(h),r=a}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return(0,G.Wp)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,R.d6)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const t=i[i.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}const W=U;var N=i(90588),q=i(43530);function K(t,e){if(!t)return null;let i;switch(t.type){case"Point":i=function(t){return new h.default(t.coordinates)}(t);break;case"LineString":i=function(t){return new F.default(t.coordinates)}(t);break;case"Polygon":i=function(t){return new Y.default(t.coordinates)}(t);break;case"MultiPoint":i=function(t){return new L(t.coordinates)}(t);break;case"MultiLineString":i=function(t){return new M(t.coordinates)}(t);break;case"MultiPolygon":i=function(t){return new W(t.coordinates)}(t);break;case"GeometryCollection":i=function(t){const e=t.geometries.map((function(t){return K(t,undefined)}));return new T(e)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return y(i,!1,e)}function V(t,e){const i=(t=y(t,!0,e)).getType();let s;switch(i){case"Point":s=function(t){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":s=function(t){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":s=function(t,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"MultiPoint":s=function(t){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":s=function(t){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":s=function(t,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"GeometryCollection":s=function(t,e){delete(e=Object.assign({},e)).featureProjection;return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){return V(t,e)}))}}(t,e);break;case"Circle":s={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return s}const B=class extends v{constructor(t){t=t||{},super(),this.dataProjection=(0,c.Jt)(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=(0,c.Jt)(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null};const s=K(i.geometry,e),r=new u.default;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(s),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){let i=null;if("FeatureCollection"===t.type){i=[];const s=t.features;for(let t=0,r=s.length;t<r;++t)i.push(this.readFeatureFromObject(s[t],e))}else i=[this.readFeatureFromObject(t,e)];return i}readGeometryFromObject(t,e){return K(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?"name"==e.type?i=(0,c.Jt)(e.properties.name):"EPSG"===e.type?i=(0,c.Jt)("EPSG:"+e.properties.code):(0,N.v)(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(void 0!==s&&(i.id=s),!t.hasProperties())return i;const r=t.getProperties(),n=t.getGeometry();return n&&(i.geometry=V(n,e),delete r[t.getGeometryName()]),(0,q.p)(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,r=t.length;s<r;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return V(t,this.adaptOptions(e))}};var J=i(74971);const $=[-16e6,-7279e3,205e5,11e6];var H=i(60764),Q=i(9703),tt=i(28290),et=i(27577),it=i(98837),st=i(2445);const rt=({vizType:t,theme:e,height:i,width:r,chartConfig:n})=>{const[o,a]=(0,s.useState)();return(0,s.useEffect)((()=>{(async t=>{const e=(0,et.A)(),i=await e.getAsPromise(t);a((()=>i))})(t)}),[t]),(0,st.Y)(it.a,{theme:e,children:void 0===o?(0,st.Y)(st.FK,{}):(0,st.Y)(o,{...n.properties,height:i,width:r})})},nt=(t,e,i,s,r)=>(0,st.Y)(rt,{vizType:t,chartConfig:e,width:i,height:s,theme:r}),ot=t=>({type:t.type,features:t.features.map((t=>({type:t.type,geometry:t.geometry,properties:Object.keys(t.properties).filter((t=>"refs"!==t)).reduce(((e,i)=>({...e,[i]:t.properties[i]})),{})})))}),at=(t,e)=>{const i=ot(t),s=ot(e);return JSON.stringify(i)===JSON.stringify(s)},ht=i.p+"loading.cff8a5da.gif";class lt extends H.A{constructor(t){super(t),this.charts=[],this.chartConfigs={type:"FeatureCollection",features:[]},this.chartSizeValues={},this.chartVizType=void 0,this.div=void 0,this.loadingMask=void 0,this.chartBackgroundCssColor="",this.chartBackgroundBorderRadius=0,this.theme=void 0,this.chartVizType=t.chartVizType,t.chartConfigs&&(this.chartConfigs=t.chartConfigs),t.chartSizeValues&&(this.chartSizeValues=t.chartSizeValues),t.chartBackgroundCssColor&&(this.chartBackgroundCssColor=t.chartBackgroundCssColor),t.chartBackgroundBorderRadius&&(this.chartBackgroundBorderRadius=t.chartBackgroundBorderRadius),t.theme&&(this.theme=t.theme);const e=document.createElement("img");e.src=ht,e.style.position="relative",e.style.width="50px",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",this.loadingMask=document.createElement("div"),this.loadingMask.style.position="relative",this.loadingMask.style.height="100%",this.loadingMask.appendChild(e),this.div=document.createElement("div"),t.onMouseOver&&(this.div.onmouseover=t.onMouseOver),t.onMouseOut&&(this.div.onmouseout=t.onMouseOut)}setChartConfig(t,e=!1){this.chartConfigs=t,e||this.changed()}setChartVizType(t,e=!1){this.chartVizType=t,e||this.changed()}setChartSizeValues(t,e=!1){this.chartSizeValues=t,e||this.changed()}setChartBackgroundCssColor(t,e=!1){this.chartBackgroundCssColor=t,e||this.changed()}setChartBackgroundBorderRadius(t,e=!1){this.chartBackgroundBorderRadius=t,e||this.changed()}removeAllChartElements(){this.charts.forEach((t=>{tt.unmountComponentAtNode(t.htmlElement),t.htmlElement.remove()})),this.charts=[]}createCharts(t){const e=this.chartConfigs.features.map((e=>{const i=document.createElement("div");let s=0,r=0;this.chartSizeValues[t]&&(s=this.chartSizeValues[t].width,r=this.chartSizeValues[t].height);const n=nt(this.chartVizType,e,s,r,this.theme);return tt.render(n,i),{htmlElement:i,coordinate:(o=e.geometry,(new B).readGeometry(o,{featureProjection:"EPSG:3857"}).getCoordinates()),width:s,height:r,feature:e};var o}));this.charts=e}updateCharts(t){const e=this.charts.map((e=>{let i=0,s=0;if(this.chartSizeValues[t]&&(i=this.chartSizeValues[t].width,s=this.chartSizeValues[t].height),i===e.width&&s===e.height)return e;const r=nt(this.chartVizType,e.feature,i,s,this.theme);return tt.render(r,e.htmlElement),{...e,width:i,height:s}}));this.charts=e}render(t){if(!t)return this.div;const{viewState:e}=t,i=Math.round(e.zoom);if(e.nextResolution)return this.loadingMask;0===this.charts.length?this.createCharts(i):this.updateCharts(i),this.charts.forEach((e=>{const{htmlElement:i,coordinate:s,width:r,height:n}=e,o=[...s],[a,h]=(0,Q.Bb)(t.coordinateToPixelTransform,o);i.style.left=a-r/2+"px",i.style.top=h-n/2+"px",i.style.position="absolute",i.style["background-color"]=this.chartBackgroundCssColor,i.style["border-radius"]=`${this.chartBackgroundBorderRadius}%`}));const s=this.charts.map((t=>t.htmlElement));return this.div.replaceChildren(...s),this.div}}var ct=i(33591),ut=i.n(ct);const dt="preload",gt="useInterimTilesOnError";class mt extends H.A{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(dt)}setPreload(t){this.set(dt,t)}getUseInterimTilesOnError(){return this.get(gt)}setUseInterimTilesOnError(t){this.set(gt,t)}getData(t){return super.getData(t)}}const pt=mt;var ft=i(41623),_t=i(79332),Tt=i(11078),Ct=i(93474);class xt extends _t.A{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(d.A.CHANGE)}release(){this.state===Tt.A.ERROR&&this.setState(Tt.A.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==Tt.A.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==Tt.A.LOADED){t.interimTile=null;break}t.getState()==Tt.A.LOADING?e=t:t.getState()==Tt.A.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==Tt.A.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){(0,C.b0)()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const s=e-i+1e3/60;return s>=this.transition_?1:(0,Ct.a6)(s/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const yt=xt;var Et=i(68711),vt=i(14837);const Ft=class extends yt{constructor(t,e,i,s,r,n){super(t,e,n),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=Tt.A.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Tt.A.ERROR,this.unlistenImage_(),this.image_=function(){const t=(0,Et.Y)(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Tt.A.LOADED:this.state=Tt.A.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Tt.A.ERROR&&(this.state=Tt.A.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Tt.A.IDLE&&(this.state=Tt.A.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,vt.f)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}},St=class{constructor(t,e,i,s,r,n){this.sourceProj_=t,this.targetProj_=e;let o={};const a=(0,c.RG)(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&(0,m.RG)(s)>=(0,m.RG)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,m.RG)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,m.RG)(this.targetProj_.getExtent()):null;const h=(0,m.Py)(i),l=(0,m.WU)(i),u=(0,m.k_)(i),d=(0,m.R)(i),g=this.transformInv_(h),p=this.transformInv_(l),f=this.transformInv_(u),_=this.transformInv_(d),T=10+(n?Math.max(0,Math.ceil(Math.log2((0,m.UG)(i)/(n*n*256*256)))):0);if(this.addQuad_(h,l,u,d,g,p,f,_,T),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,i,s){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach((e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const s=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-s<this.sourceWorldWidth_/2&&(e.source=i)}}))}o={}}addTriangle_(t,e,i,s,r,n){this.triangles_.push({source:[s,r,n],target:[t,e,i]})}addQuad_(t,e,i,s,r,n,o,a,h){const l=(0,m.Tr)([r,n,o,a]),c=this.sourceWorldWidth_?(0,m.RG)(l)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&c>.5&&c<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const r=(0,m.Tr)([t,e,i,s]);g=(0,m.RG)(r)/this.targetWorldWidth_>.25||g}!d&&this.sourceProj_.isGlobal()&&c&&(g=c>.25||g)}if(!g&&this.maxSourceExtent_&&isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])&&isFinite(l[3])&&!(0,m.HY)(l,this.maxSourceExtent_))return;let p=0;if(!(g||isFinite(r[0])&&isFinite(r[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])))if(h>0)g=!0;else if(p=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(n[0])&&isFinite(n[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=p&&2!=p&&4!=p&&8!=p)return;if(h>0){if(!g){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],s=this.transformInv_(e);let n;n=d?((0,I.xP)(r[0],u)+(0,I.xP)(o[0],u))/2-(0,I.xP)(s[0],u):(r[0]+o[0])/2-s[0];const a=(r[1]+o[1])/2-s[1];g=n*n+a*a>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const l=[(e[0]+i[0])/2,(e[1]+i[1])/2],c=this.transformInv_(l),u=[(s[0]+t[0])/2,(s[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,l,u,r,n,c,d,h-1),this.addQuad_(u,l,i,s,d,c,o,a,h-1)}else{const l=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=this.transformInv_(l),u=[(i[0]+s[0])/2,(i[1]+s[1])/2],d=this.transformInv_(u);this.addQuad_(t,l,u,s,r,c,d,a,h-1),this.addQuad_(l,e,i,u,c,n,o,d,h-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&p||this.addTriangle_(t,i,s,r,o,a),14&p||this.addTriangle_(t,i,e,r,o,n),p&&(13&p||this.addTriangle_(e,s,t,n,a,r),7&p||this.addTriangle_(e,s,i,n,a,o))}calculateSourceExtent(){const t=(0,m.S5)();return this.triangles_.forEach((function(e,i,s){const r=e.source;(0,m.$C)(t,r[0]),(0,m.$C)(t,r[1]),(0,m.$C)(t,r[2])})),t}getTriangles(){return this.triangles_}};let Pt;const Rt=[];function wt(t,e,i,s,r){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(s,r),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,s)+1,Math.max(i,r)),t.restore()}function jt(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function At(t,e,i,s){const r=(0,c.pd)(i,e,t);let n=(0,c.hO)(e,s,i);const o=e.getMetersPerUnit();void 0!==o&&(n*=o);const a=t.getMetersPerUnit();void 0!==a&&(n/=a);const h=t.getExtent();if(!h||(0,m.Ym)(h,r)){const e=(0,c.hO)(t,n,r)/n;isFinite(e)&&e>0&&(n/=e)}return n}const bt=class extends yt{constructor(t,e,i,s,r,n,o,a,h,l,c,u){super(r,Tt.A.IDLE,{interpolate:!!u}),this.renderEdges_=void 0!==c&&c,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=n||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const d=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const f=g?(0,m._N)(d,g):d;if(0===(0,m.UG)(f))return void(this.state=Tt.A.EMPTY);const _=t.getExtent();_&&(p=p?(0,m._N)(p,_):_);const T=s.getResolution(this.wrappedTileCoord_[0]),C=function(t,e,i,s){const r=(0,m.q1)(i);let n=At(t,e,r,s);return(!isFinite(n)||n<=0)&&(0,m.sB)(i,(function(i){return n=At(t,e,i,s),isFinite(n)&&n>0})),n}(t,i,f,T);if(!isFinite(C)||C<=0)return void(this.state=Tt.A.EMPTY);const x=void 0!==l?l:.5;if(this.triangulation_=new St(t,i,f,p,C*x,T),0===this.triangulation_.getTriangles().length)return void(this.state=Tt.A.EMPTY);this.sourceZ_=e.getZForResolution(C);let y=this.triangulation_.calculateSourceExtent();if(p&&(t.canWrapX()?(y[1]=(0,I.qE)(y[1],p[1],p[3]),y[3]=(0,I.qE)(y[3],p[1],p[3])):y=(0,m._N)(y,p)),(0,m.UG)(y)){const t=e.getTileRangeForExtentAndZ(y,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=h(this.sourceZ_,e,i,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=Tt.A.EMPTY)}else this.state=Tt.A.EMPTY}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((e=>{e&&e.getState()==Tt.A.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})})),this.sourceTiles_.length=0,0===t.length)this.state=Tt.A.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"==typeof i?i:i[0],r="number"==typeof i?i:i[1],n=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(t,e,i,s,r,n,o,a,h,l,c,u){const d=(0,Et.Y)(Math.round(i*t),Math.round(i*e),Rt);if(u||(d.imageSmoothingEnabled=!1),0===h.length)return d.canvas;function g(t){return Math.round(t*i)/i}d.scale(i,i),d.globalCompositeOperation="lighter";const p=(0,m.S5)();h.forEach((function(t,e,i){(0,m.X$)(p,t.extent)}));const f=(0,m.RG)(p),_=(0,m.Oq)(p),T=(0,Et.Y)(Math.round(i*f/s),Math.round(i*_/s),Rt);u||(T.imageSmoothingEnabled=!1);const C=i/s;h.forEach((function(t,e,i){const s=t.extent[0]-p[0],r=-(t.extent[3]-p[3]),n=(0,m.RG)(t.extent),o=(0,m.Oq)(t.extent);t.image.width>0&&t.image.height>0&&T.drawImage(t.image,l,l,t.image.width-2*l,t.image.height-2*l,s*C,r*C,n*C,o*C)}));const x=(0,m.Py)(o);return a.getTriangles().forEach((function(t,e,r){const o=t.source,a=t.target;let h=o[0][0],l=o[0][1],c=o[1][0],m=o[1][1],f=o[2][0],_=o[2][1];const C=g((a[0][0]-x[0])/n),y=g(-(a[0][1]-x[1])/n),E=g((a[1][0]-x[0])/n),v=g(-(a[1][1]-x[1])/n),F=g((a[2][0]-x[0])/n),S=g(-(a[2][1]-x[1])/n),P=h,R=l;h=0,l=0,c-=P,m-=R,f-=P,_-=R;const w=[[c,m,0,0,E-C],[f,_,0,0,F-C],[0,0,c,m,v-y],[0,0,f,_,S-y]],j=(0,I.KU)(w);if(j){if(d.save(),d.beginPath(),function(){if(void 0===Pt){const t=(0,Et.Y)(6,6,Rt);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",wt(t,4,5,4,0),wt(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;Pt=jt(e,0)||jt(e,4)||jt(e,8),(0,Et.Yg)(t),Rt.push(t.canvas)}return Pt}()||!u){d.moveTo(E,v);const t=4,e=C-E,i=y-v;for(let s=0;s<t;s++)d.lineTo(E+g((s+1)*e/t),v+g(s*i/(t-1))),s!=t-1&&d.lineTo(E+g((s+1)*e/t),v+g((s+1)*i/(t-1)));d.lineTo(F,S)}else d.moveTo(E,v),d.lineTo(C,y),d.lineTo(F,S);d.clip(),d.transform(j[0],j[2],j[1],j[3],C,y),d.translate(p[0]-P,p[3]-R),d.scale(s/i,-s/i),d.drawImage(T.canvas,0,0),d.restore()}})),(0,Et.Yg)(T),Rt.push(T.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach((function(t,e,i){const s=t.target,r=(s[0][0]-x[0])/n,o=-(s[0][1]-x[1])/n,a=(s[1][0]-x[0])/n,h=-(s[1][1]-x[1])/n,l=(s[2][0]-x[0])/n,c=-(s[2][1]-x[1])/n;d.beginPath(),d.moveTo(a,h),d.lineTo(r,o),d.lineTo(l,c),d.closePath(),d.stroke()})),d.restore()),d.canvas}(s,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),n,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=Tt.A.LOADED}this.changed()}load(){if(this.state==Tt.A.IDLE){this.state=Tt.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((e=>{const i=e.getState();if(i==Tt.A.IDLE||i==Tt.A.LOADING){t++;const i=(0,p.KT)(e,d.A.CHANGE,(function(s){const r=e.getState();r!=Tt.A.LOADED&&r!=Tt.A.ERROR&&r!=Tt.A.EMPTY||((0,p.JH)(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(i)}})),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,i){t.getState()==Tt.A.IDLE&&t.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(p.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,Et.Yg)(this.canvas_.getContext("2d")),Rt.push(this.canvas_),this.canvas_=null),super.release()}};class Gt{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Ot(t,e,i,s,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=i,r.maxY=s,r):new Gt(t,e,i,s)}const Mt=Gt;var It=i(6782);class zt extends ft.A{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,m.S5)(),this.tmpTileRange_=new Mt(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),s=e.getUseInterimTilesOnError();return i==Tt.A.LOADED||i==Tt.A.EMPTY||i==Tt.A.ERROR&&!s}getTile(t,e,i,s){const r=s.pixelRatio,n=s.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,i,r,n);return a.getState()==Tt.A.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=(0,Q.Bb)(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!(0,m.Ym)(r,s))return null;const n=e.pixelRatio,o=e.viewState.projection,a=e.viewState,h=i.getRenderSource(),l=h.getTileGridForProjection(a.projection),c=h.getTilePixelRatio(e.pixelRatio);for(let t=l.getZForResolution(a.resolution);t>=l.getMinZoom();--t){const e=l.getTileCoordForCoordAndZ(s,t),i=h.getTile(t,e[1],e[2],n,o);if(!(i instanceof Ft||i instanceof bt)||i instanceof bt&&i.getState()===Tt.A.EMPTY)return null;if(i.getState()!==Tt.A.LOADED)continue;const r=l.getOrigin(t),u=(0,It.xq)(l.getTileSize(t)),d=l.getResolution(t),g=Math.floor(c*((s[0]-r[0])/d-e[1]*u[0])),m=Math.floor(c*((r[1]-s[1])/d-e[2]*u[1])),p=Math.round(c*h.getGutterForProjection(a.projection));return this.getImageData(i.getImage(),g+p,m+p)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,n=s.resolution,o=s.center,a=s.rotation,h=t.pixelRatio,l=this.getLayer(),u=l.getSource(),d=u.getRevision(),g=u.getTileGridForProjection(r),p=g.getZForResolution(n,u.zDirection),f=g.getResolution(p);let _=t.extent;const T=t.viewState.resolution,x=u.getTilePixelRatio(h),y=Math.round((0,m.RG)(_)/T*h),E=Math.round((0,m.Oq)(_)/T*h),v=i.extent&&(0,c.SD)(i.extent,r);v&&(_=(0,m._N)(_,(0,c.SD)(i.extent,r)));const F=f*y/2/x,S=f*E/2/x,P=[o[0]-F,o[1]-S,o[0]+F,o[1]+S],R=g.getTileRangeForExtentAndZ(_,p),w={};w[p]={};const A=this.createLoadedTileFinder(u,r,w),b=this.tmpExtent,G=this.tmpTileRange_;this.newTiles_=!1;const O=a?(0,m.Yw)(s.center,T,a,t.size):void 0;for(let e=R.minX;e<=R.maxX;++e)for(let s=R.minY;s<=R.maxY;++s){if(a&&!g.tileCoordIntersectsViewport([p,e,s],O))continue;const r=this.getTile(p,e,s,t);if(this.isDrawableTile(r)){const e=(0,C.v6)(this);if(r.getState()==Tt.A.LOADED){w[p][r.tileCoord.toString()]=r;let t=r.inTransition(e);t&&1!==i.opacity&&(r.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(r)||(this.newTiles_=!0)}if(1===r.getAlpha(e,t.time))continue}const n=g.getTileCoordChildTileRange(r.tileCoord,G,b);let o=!1;n&&(o=A(p+1,n)),o||g.forEachTileCoordParentTileRange(r.tileCoord,A,G,b)}const M=f/n*h/x;(0,Q.Zz)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,a,-y/2,-E/2);const I=(0,Q.dI)(this.pixelTransform);this.useContainer(e,I,this.getBackground(t));const z=this.context,L=z.canvas;(0,Q.T9)(this.inversePixelTransform,this.pixelTransform),(0,Q.Zz)(this.tempTransform,y/2,E/2,M,M,0,-y/2,-E/2),L.width!=y||L.height!=E?(L.width=y,L.height=E):this.containerReused||z.clearRect(0,0,y,E),v&&this.clipUnrotated(z,t,v),u.getInterpolate()||(z.imageSmoothingEnabled=!1),this.preRender(z,t),this.renderedTiles.length=0;let Y,k,X,D=Object.keys(w).map(Number);D.sort(j.V_),1!==i.opacity||this.containerReused&&!u.getOpaque(t.viewState.projection)?(Y=[],k=[]):D=D.reverse();for(let e=D.length-1;e>=0;--e){const i=D[e],s=u.getTilePixelSize(i,h,r),n=g.getResolution(i)/f,o=s[0]*n*M,a=s[1]*n*M,l=g.getTileCoordForCoordAndZ((0,m.Py)(P),i),c=g.getTileCoordExtent(l),d=(0,Q.Bb)(this.tempTransform,[x*(c[0]-P[0])/f,x*(P[3]-c[3])/f]),_=x*u.getGutterForProjection(r),T=w[i];for(const e in T){const s=T[e],r=s.tileCoord,n=l[1]-r[1],h=Math.round(d[0]-(n-1)*o),c=l[2]-r[2],g=Math.round(d[1]-(c-1)*a),f=Math.round(d[0]-n*o),x=Math.round(d[1]-c*a),y=h-f,E=g-x,v=p===i,F=v&&1!==s.getAlpha((0,C.v6)(this),t.time);let S=!1;if(!F)if(Y){X=[f,x,f+y,x,f+y,x+E,f,x+E];for(let t=0,e=Y.length;t<e;++t)if(p!==i&&i<k[t]){const e=Y[t];(0,m.HY)([f,x,f+y,x+E],[e[0],e[3],e[4],e[7]])&&(S||(z.save(),S=!0),z.beginPath(),z.moveTo(X[0],X[1]),z.lineTo(X[2],X[3]),z.lineTo(X[4],X[5]),z.lineTo(X[6],X[7]),z.moveTo(e[6],e[7]),z.lineTo(e[4],e[5]),z.lineTo(e[2],e[3]),z.lineTo(e[0],e[1]),z.clip())}Y.push(X),k.push(i)}else z.clearRect(f,x,y,E);this.drawTileImage(s,t,f,x,y,E,_,v),Y&&!F?(S&&z.restore(),this.renderedTiles.unshift(s)):this.renderedTiles.push(s),this.updateUsedTiles(t.usedTiles,u,s)}}return this.renderedRevision=d,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!(0,m.aI)(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,u,g,h,r,_,p,l.getPreload()),this.scheduleExpireCache(t,u),this.postRender(z,t),i.extent&&z.restore(),z.imageSmoothingEnabled=!0,I!==L.style.transform&&(L.style.transform=I),this.container}drawTileImage(t,e,i,s,r,n,o,a){const h=this.getTileImage(t);if(!h)return;const l=(0,C.v6)(this),c=e.layerStatesArray[e.layerIndex],u=c.opacity*(a?t.getAlpha(l,e.time):1),d=u!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(h,o,o,h.width-2*o,h.height-2*o,i,s,r,n),d&&this.context.restore(),u!==c.opacity?e.animate=!0:a&&t.endTransition(l)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const s=(0,C.v6)(t);s in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[s])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const s=(0,C.v6)(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}manageTilePyramid(t,e,i,s,r,n,o,a,h){const l=(0,C.v6)(e);l in t.wantedTiles||(t.wantedTiles[l]={});const c=t.wantedTiles[l],u=t.tileQueue,d=i.getMinZoom(),g=t.viewState.rotation,p=g?(0,m.Yw)(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let f,_,T,x,y,E,v=0;for(E=d;E<=o;++E)for(_=i.getTileRangeForExtentAndZ(n,E,_),T=i.getResolution(E),x=_.minX;x<=_.maxX;++x)for(y=_.minY;y<=_.maxY;++y)g&&!i.tileCoordIntersectsViewport([E,x,y],p)||(o-E<=a?(++v,f=e.getTile(E,x,y,s,r),f.getState()==Tt.A.IDLE&&(c[f.getKey()]=!0,u.isKeyQueued(f.getKey())||u.enqueue([f,l,i.getTileCoordCenter(f.tileCoord),T])),void 0!==h&&h(f)):e.useTile(E,x,y,r));e.updateCacheSize(v,r)}}const Lt=zt,Yt=class extends pt{constructor(t){super(t)}createRenderer(){return new Lt(this)}},kt=class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return(0,N.v)(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return(0,N.v)(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){(0,N.v)(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};function Xt(t,e,i,s){return void 0!==s?(s[0]=t,s[1]=e,s[2]=i,s):[t,e,i]}function Dt(t,e,i){return t+"/"+e+"/"+i}function Zt(t){return Dt(t[0],t[1],t[2])}function Ut(t){return(t[1]<<t[0])+t[2]}const Wt=class extends kt{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=this.peekFirstKey().split("/").map(Number)[0];this.forEach((e=>{e.tileCoord[0]!==t&&(this.remove(Zt(e.tileCoord)),e.release())}))}};var Nt=i(1685),qt=i(16444),Kt=i(57115);const Vt=[0,0,0],Bt=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,(0,N.v)((0,j.WC)(this.resolutions_,(function(t,e){return e-t}),!0),17),!t.origins)for(let t=0,i=this.resolutions_.length-1;t<i;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,(0,N.v)(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=(0,m.Py)(i)),(0,N.v)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,(0,N.v)(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Kt.R,(0,N.v)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){const s=new Mt(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){const t=this.getTileRangeForExtentAndZ(i,e);s.minX=Math.max(t.minX,s.minX),s.maxX=Math.min(t.maxX,s.maxX),s.minY=Math.max(t.minY,s.minY),s.maxY=Math.min(t.maxY,s.maxY)}return s}),this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let t=s.minX,r=s.maxX;t<=r;++t)for(let r=s.minY,n=s.maxY;r<=n;++r)i([e,t,r])}forEachTileCoordParentTileRange(t,e,i,s){let r,n,o,a=null,h=t[0]-1;for(2===this.zoomFactor_?(n=t[1],o=t[2]):a=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(2===this.zoomFactor_?(n=Math.floor(n/2),o=Math.floor(o/2),r=Ot(n,n,o,o,i)):r=this.getTileRangeForExtentAndZ(a,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],s=2*t[2];return Ot(i,i+1,s,s+1,e)}const s=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],n=t[2];if(e===s)return Ot(r,n,r,n,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-s),o=Math.floor(r*t),a=Math.floor(n*t);return e<s?Ot(o,o,a,a,i):Ot(o,Math.floor(t*(r+1))-1,a,Math.floor(t*(n+1))-1,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Vt);const s=Vt[1],r=Vt[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Vt),Ot(s,Vt[1],r,Vt[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=(0,It.xq)(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=(0,It.xq)(this.getTileSize(t[0]),this.tmpSize_),n=i[0]+t[1]*r[0]*s,o=i[1]-(t[2]+1)*r[1]*s,a=n+r[0]*s,h=o+r[1]*s;return(0,m.N)(n,o,a,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const n=this.getZForResolution(i),o=i/this.getResolution(n),a=this.getOrigin(n),h=(0,It.xq)(this.getTileSize(n),this.tmpSize_);let l=o*(t-a[0])/i/h[0],c=o*(a[1]-e)/i/h[1];return s?(l=(0,I.mk)(l,5)-1,c=(0,I.mk)(c,5)-1):(l=(0,I.RI)(l,5),c=(0,I.RI)(c,5)),Xt(n,l,c,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const n=this.getOrigin(i),o=this.getResolution(i),a=(0,It.xq)(this.getTileSize(i),this.tmpSize_);let h=(t-n[0])/o/a[0],l=(n[1]-e)/o/a[1];return s?(h=(0,I.mk)(h,5)-1,l=(0,I.mk)(l,5)-1):(h=(0,I.RI)(h,5),l=(0,I.RI)(l,5)),Xt(i,h,l,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=(0,j.FT)(this.resolutions_,t,e||0);return(0,I.qE)(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return(0,G.sj)(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}};function Jt(t){let e=t.getDefaultTileGrid();return e||(e=function(t){return function(t,e,i,s){s=void 0!==s?s:"top-left";const r=$t(t,e,i);return new Bt({extent:t,origin:(0,m.qF)(t,s),resolutions:r,tileSize:i})}(Ht(t),void 0,void 0,void 0)}(t),t.setDefaultTileGrid(e)),e}function $t(t,e,i,s){e=void 0!==e?e:Kt.L,i=(0,It.xq)(void 0!==i?i:Kt.R);const r=(0,m.Oq)(t),n=(0,m.RG)(t);s=s>0?s:Math.max(n/i[0],r/i[1]);const o=e+1,a=new Array(o);for(let t=0;t<o;++t)a[t]=s/Math.pow(2,t);return a}function Ht(t){let e=(t=(0,c.Jt)(t)).getExtent();if(!e){const i=180*c.Ig.degrees/t.getMetersPerUnit();e=(0,m.N)(-i,-i,i,i)}return e}class Qt extends qt.A{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileGrid&&(0,It.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new Wt(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,s){const r=this.getTileCacheForProjection(t);if(!r)return!1;let n,o,a,h=!0;for(let t=i.minX;t<=i.maxX;++t)for(let l=i.minY;l<=i.maxY;++l)o=Dt(e,t,l),a=!1,r.containsKey(o)&&(n=r.get(o),a=n.getState()===Tt.A.LOADED,a&&(a=!1!==s(n))),a||(h=!1);return h}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,s,r){return(0,C.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Jt(t)}getTileCacheForProjection(t){const e=this.getProjection();return(0,N.v)(null===e||(0,c.tI)(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),n=(0,It.xq)(s.getTileSize(t),this.tmpSize);return 1==r?n:(0,It.hs)(n,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(t,e,i){const s=e[0],r=t.getTileCoordCenter(e),n=Ht(i);if(!(0,m.Ym)(n,r)){const e=(0,m.RG)(n),i=Math.ceil((n[0]-r[0])/e);return r[0]+=e*i,t.getTileCoordForCoordAndZ(r,s)}return e}(i,t,e)),function(t,e){const i=t[0],s=t[1],r=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const n=e.getFullTileRange(i);return!n||n.containsXY(s,r)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,s){}}class te extends Nt.Ay{constructor(t,e){super(t),this.tile=e}}const ee=Qt;function ie(t,e){const i=/\{z\}/g,s=/\{x\}/g,r=/\{y\}/g,n=/\{-y\}/g;return function(o,a,h){if(o)return t.replace(i,o[0].toString()).replace(s,o[1].toString()).replace(r,o[2].toString()).replace(n,(function(){const t=o[0],i=e.getFullTileRange(t);return(0,N.v)(i,55),(i.getHeight()-o[2]-1).toString()}))}}class se extends ee{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===se.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=(0,C.v6)(e),s=e.getState();let r;s==Tt.A.LOADING?(this.tileLoadingKeys_[i]=!0,r="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==Tt.A.ERROR?"tileloaderror":s==Tt.A.LOADED?"tileloadend":void 0),null!=r&&this.dispatchEvent(new te(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const s=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let n;for(n=s;n<=r;++n)e.push(t.replace(i[0],String.fromCharCode(n)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const s=parseInt(i[2],10);for(let r=parseInt(i[1],10);r<=s;r++)e.push(t.replace(i[0],r.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const i=t.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ie(t[r],e);return function(t){return 1===t.length?t[0]:function(e,i,s){if(!e)return;const r=Ut(e),n=(0,I.xP)(r,t.length);return t[n](e,i,s)}}(s)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const s=Dt(t,e,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const re=se;function ne(t,e){t.getImage().src=e}const oe=class extends re{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ne,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:Ft,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){const s=this.tileCacheForProjection[t];s.expireCache(s==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!(0,c.tI)(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!(0,c.tI)(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||(0,c.tI)(e,t)))return this.tileGrid;const i=(0,C.v6)(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Jt(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||(0,c.tI)(e,t))return this.tileCache;const i=(0,C.v6)(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Wt(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,s,r,n){const o=[t,e,i],a=this.getTileCoordForTileUrlFunction(o,r),h=a?this.tileUrlFunction(a,s,r):void 0,l=new this.tileClass(o,void 0!==h?Tt.A.IDLE:Tt.A.EMPTY,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=n,l.addEventListener(d.A.CHANGE,this.handleTileChange.bind(this)),l}getTile(t,e,i,s,r){const n=this.getProjection();if(!n||!r||(0,c.tI)(n,r))return this.getTileInternal(t,e,i,s,n||r);const o=this.getTileCacheForProjection(r),a=[t,e,i];let h;const l=Zt(a);o.containsKey(l)&&(h=o.get(l));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(n),g=this.getTileGridForProjection(r),m=this.getTileCoordForTileUrlFunction(a,r),p=new bt(n,d,r,g,a,m,this.getTilePixelRatio(s),this.getGutter(),((t,e,i,s)=>this.getTileInternal(t,e,i,s,n)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return p.key=u,h?(p.interimTile=h,p.refreshInterimChain(),o.replace(l,p)):o.set(l,p),p}getTileInternal(t,e,i,s,r){let n=null;const o=Dt(t,e,i),a=this.getKey();if(this.tileCache.containsKey(o)){if(n=this.tileCache.get(o),n.key!=a){const h=n;n=this.createTile_(t,e,i,s,r,a),h.getState()==Tt.A.IDLE?n.interimTile=h.interimTile:n.interimTile=h,n.refreshInterimChain(),this.tileCache.replace(o,n)}}else n=this.createTile_(t,e,i,s,r,a),this.tileCache.set(o,n);return n}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){const i=(0,c.Jt)(t);if(i){const t=(0,C.v6)(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},ae="1.3.0";function he(t,e){const i=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))}));const s=i.join("&");return t=t.replace(/[?&]$/,""),(t+=t.includes("?")?"&":"?")+s}const le=class extends oe{constructor(t){t=t||{};const e=Object.assign({},t.params),i=!("TRANSPARENT"in e)||e.TRANSPARENT;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!i,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=(0,m.S5)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,s){const r=(0,c.Jt)(i),n=this.getProjection();let o=this.getTileGrid();o||(o=this.getTileGridForProjection(r));const a=o.getZForResolution(e,this.zDirection),h=o.getTileCoordForCoordAndZ(t,a);if(o.getResolutions().length<=h[0])return;let l=o.getResolution(h[0]),u=o.getTileCoordExtent(h,this.tmpExtent_),d=(0,It.xq)(o.getTileSize(h[0]),this.tmpSize);const g=this.gutter_;0!==g&&(d=(0,It.r)(d,g,this.tmpSize),u=(0,m.r)(u,l*g,u)),n&&n!==r&&(l=At(n,r,t,l),u=(0,c.DI)(u,r,n),t=(0,c.pd)(t,r,n));const p={SERVICE:"WMS",VERSION:ae,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,this.params_,s);const f=Math.floor((t[0]-u[0])/l),_=Math.floor((u[3]-t[1])/l);return p[this.v13_?"I":"X"]=f,p[this.v13_?"J":"Y"]=_,this.getRequestUrl_(h,d,u,1,n||r,p)}getLegendUrl(t,e){if(void 0===this.urls[0])return;const i={SERVICE:"WMS",VERSION:ae,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){const t=this.params_.LAYERS;if(Array.isArray(t)&&1!==t.length)return;i.LAYER=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;i.SCALE=t*e/s}return Object.assign(i,e),he(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,s,r,n){const o=this.urls;if(!o)return;if(n.WIDTH=e[0],n.HEIGHT=e[1],n[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(n.STYLES=""),1!=s)switch(this.serverType_){case"geoserver":const t=90*s+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+t:n.FORMAT_OPTIONS="dpi:"+t;break;case"mapserver":n.MAP_RESOLUTION=90*s;break;case"carmentaserver":case"qgis":n.DPI=90*s;break;default:(0,N.v)(!1,52)}const a=r.getAxisOrientation(),h=i;if(this.v13_&&"ne"==a.substr(0,2)){let t;t=i[0],h[0]=i[1],h[1]=t,t=i[2],h[2]=i[3],h[3]=t}let l;return n.BBOX=h.join(","),l=1==o.length?o[0]:o[(0,I.xP)(Ut(t),o.length)],he(l,n)}getTilePixelRatio(t){return this.hidpi_&&void 0!==this.serverType_?t:1}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||ae;this.v13_=function(t){const e=(""+t).split("."),i="1.3".split(".");for(let t=0;t<Math.max(e.length,i.length);t++){const s=parseInt(e[t]||"0",10),r=parseInt(i[t]||"0",10);if(s>r)return 1;if(r>s)return-1}return 0}(t)>=0}tileUrlFunction(t,e,i){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(i)),s.getResolutions().length<=t[0])return;1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);const r=s.getResolution(t[0]);let n=s.getTileCoordExtent(t,this.tmpExtent_),o=(0,It.xq)(s.getTileSize(t[0]),this.tmpSize);const a=this.gutter_;0!==a&&(o=(0,It.r)(o,a,this.tmpSize),n=(0,m.r)(n,r*a,n)),1!=e&&(o=(0,It.hs)(o,e,this.tmpSize));const h={SERVICE:"WMS",VERSION:ae,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(h,this.params_),this.getRequestUrl_(t,o,n,e,i,h)}};var ce=i(60942),ue=i(96079);const de=class extends oe{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:function(t){const e=t||{},i=e.extent||(0,c.Jt)("EPSG:3857").getExtent(),s={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:$t(i,e.maxZoom,e.tileSize,e.maxResolution)};return new Bt(s)}({extent:Ht(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},ge=(t,e,i)=>{const s={WMS:["1.3.0","1.1.1"],WFS:["2.0.2","2.0.0","1.1.0"]}[i];s.reverse();const r=s.indexOf(t);if(-1===r)return!1;const n=s.indexOf(e);return-1!==n&&r<n},me=async t=>{let e;return(t=>"WMS"===t.type)(t)?e=(t=>{const{url:e,layersParam:i,version:s,attribution:r}=t;return new Yt({source:new le({url:e,params:{LAYERS:i,VERSION:s},attributions:r})})})(t):(t=>"WFS"===t.type)(t)?e=await(async t=>{var e;const{url:i,typeName:s,maxFeatures:r,version:n="1.1.0",style:o,attribution:a}=t,h=new J.default({format:new B,attributions:a,url:t=>{const e=new URL(i),o=e.searchParams;o.append("service","wfs"),o.append("request","GetFeature"),o.append("outputFormat","application/json"),o.append("srsName","EPSG:3857"),o.append("version",n);let a="typeNames";if(ge(n,"2.0.0","WFS")&&(a="typeName"),o.append(a,s),o.append("bbox",t.join(",")),r){let t="count";ge(n,"2.0.0","WFS")&&(t="maxFeatures"),o.append(t,r.toString())}return e.toString()},strategy:ce.Qk});let l;if(o){const t=new(ut());if(l=await t.writeStyle(o),l.errors)return void console.warn("Could not create ol-style",l.errors)}return new ue.default({source:h,style:null==(e=l)?void 0:e.output})})(t):(t=>"XYZ"===t.type)(t)?e=(t=>{const{url:e,attribution:i}=t;return new Yt({source:new de({url:e,attributions:i})})})(t):console.warn("Provided layerconfig is not recognized"),e},pe=t=>{const{height:e,width:i,mapId:r,olMap:n,chartConfigs:o,chartSize:u,chartVizType:d,layerConfigs:g,mapView:m,chartBackgroundColor:p,chartBackgroundBorderRadius:f,setControlValue:_,theme:T}=t,[C,x]=(0,s.useState)(o),[y,E]=(0,s.useState)(m);return(0,s.useEffect)((()=>{n.setTarget(r)}),[n,r]),(0,s.useEffect)((()=>{n.updateSize()}),[n,i,e]),(0,s.useEffect)((()=>{x((t=>at(o,t)?t:o))}),[o]),(0,s.useEffect)((()=>{E((t=>{const e=t.fixedZoom===m.fixedZoom,i=t.fixedLongitude===m.fixedLongitude,s=t.fixedLatitude===m.fixedLatitude,r=t.mode===m.mode;return e&&i&&s&&r?t:m}))}),[m]),(0,s.useEffect)((()=>{const t=n.getView(),{mode:e,fixedLatitude:i,fixedLongitude:s,fixedZoom:r}=m;switch(e){case"CUSTOM":{const e=new h.default([s,i]);e.transform("EPSG:4326","EPSG:3857"),t.setZoom(r),t.setCenter(e.getCoordinates());break}default:{((t,e)=>{const i=t.getView(),s=(t=>{if(0===t.length)return;const e=new J.default;return e.addFeatures(t),e.getExtent()})((new B).readFeatures(e,{featureProjection:"EPSG:3857"}))||$;i.fit(s,{size:[250,250]})})(n,o);const e=t.getZoom(),i=t.getCenter();if(!i)return;const s=new h.default(i);s.transform("EPSG:3857","EPSG:4326");const[r,a]=s.getCoordinates();_("map_view",{...m,zoom:e,longitude:r,latitude:a,fixedLatitude:a,fixedLongitude:r,fixedZoom:e});break}}}),[]),(0,s.useEffect)((()=>{n.getLayers().getArray().filter((t=>!(t instanceof lt))).forEach((t=>{n.removeLayer(t)})),(async t=>{const e=t.map(me);(await Promise.allSettled(e)).forEach(((e,i)=>{"fulfilled"===e.status&&e.value?n.getLayers().insertAt(0,e.value):console.warn(`Layer could not be created: ${t[i]}`)}))})(g)}),[n,g]),(0,s.useEffect)((()=>{const{fixedLatitude:t,fixedLongitude:e,fixedZoom:i}=y,s=n.getView(),r=function(t,e=100){let i;return function(...s){clearTimeout(i),i=window.setTimeout((()=>t.apply(this,s)),e)}}((s=>{(s=>{const r=s.target,n=r.getCenter(),o=r.getZoom();if(!n)return;const[a,h]=(0,c.WP)(n);_("map_view",{...y,zoom:o,longitude:a,latitude:h,fixedLatitude:t,fixedLongitude:e,fixedZoom:i})})(s)})),o=s.on("change",r);return()=>{(0,l.e)(o)}}),[n,_,y,C]),(0,s.useEffect)((()=>{if("FIT_DATA"===y.mode){const t=n.getLayers().getArray().find((t=>t instanceof lt));if(!t)return;const e=t.getExtent();if(!e)return;n.getView().fit(e,{size:[250,250]})}}),[n,y.mode]),(0,s.useEffect)((()=>{const t=n.getView(),e=a()((t=>{(t=>{const e=t.target.getZoom();if(!e)return;const i=Math.round(u.configs.zoom),s=Math.round(e);if(i===s)return;const r={...u,configs:{...u.configs,zoom:s}};_("chart_size",r)})(t)}),100),i=t.on("change:resolution",e);return()=>{(0,l.e)(i)}}),[n,_,u]),(0,s.useEffect)((()=>{const t=n.getLayers(),e=t.getArray().find((t=>t instanceof lt)),{r:i,g:s,b:r,a:o}=p,a=`rgba(${i}, ${s}, ${r}, ${o})`;if(e){let t=!1;d!==e.chartVizType&&(e.setChartVizType(d,!0),t=!0),at(C,e.chartConfigs)||(e.setChartConfig(C,!0),t=!0),e.setChartBackgroundBorderRadius(f,!0),e.setChartBackgroundCssColor(a,!0),e.setChartSizeValues(u.values,!0),t&&e.removeAllChartElements(),e.changed()}else{t.forEach((t=>{t instanceof lt&&(t.removeAllChartElements(),n.removeLayer(t))}));const e=()=>{n.getInteractions().forEach((t=>{t.setActive(!1)}))},i=()=>{n.getInteractions().forEach((t=>{t.setActive(!0)}))},s=new lt({name:"openlayers-chart-layer",chartConfigs:C,chartVizType:d,chartSizeValues:u.values,chartBackgroundCssColor:a,chartBackgroundBorderRadius:f,onMouseOver:e,onMouseOut:i,theme:T});n.addLayer(s)}}),[n,T,C,d,u.values,p,f]),(0,st.Y)("div",{id:r,style:{height:`${e}px`,width:`${i}px`}})};i(82947);const fe=r.I4.div`
  height: ${({height:t})=>t}px;
  width: ${({width:t})=>t}px;
`;function _e(t){const{height:e,width:i}=t,o=(0,r.DP)(),a=(0,s.createRef)(),[h]=(0,s.useState)(`cartodiagram-plugin-${Math.floor(1e6*Math.random())}`),[l]=(0,s.useState)(new n.default({}));return(0,st.Y)(fe,{ref:a,height:e,width:i,theme:o,children:(0,st.Y)(pe,{mapId:h,olMap:l,...t})})}}}]);