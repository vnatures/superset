"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3677],{11816:(e,t,a)=>{a.d(t,{CR:()=>d,Dy:()=>c,m0:()=>u});var n=a(96540),i=a(43561),o=a(95579),r=a(35742),s=a(58561),l=a.n(s);function d(e,t,a){return n.Children.map(e,(e=>{let i=e;return e&&e.type.name===t.name&&(i=(0,n.cloneElement)(e,a(e))),i&&i.props.children&&(i=(0,n.cloneElement)(i,{children:d(i.props.children,t,a)})),i}))}function c(e,t,a){const n=t.map((e=>e.column_name)),r=e.reduce(((e,t)=>(e[t.column_name]=t,e)),{}),s={added:[],modified:[],removed:e.filter((e=>!(e.expression||n.includes(e.column_name)))).map((e=>e.column_name)),finalColumns:[]};return t.forEach((e=>{const t=r[e.column_name];t?t.type!==e.type||t.is_dttm!==e.is_dttm?(s.finalColumns.push({...t,type:e.type,is_dttm:t.is_dttm||e.is_dttm}),s.modified.push(e.column_name)):s.finalColumns.push(t):(s.finalColumns.push({id:(0,i.Ak)(),column_name:e.column_name,type:e.type,groupby:!0,filterable:!0,is_dttm:e.is_dttm}),s.added.push(e.column_name))})),e.filter((e=>e.expression)).forEach((e=>{s.finalColumns.push(e)})),s.modified.length&&a((0,o.tn)("Modified 1 column in the virtual dataset","Modified %s columns in the virtual dataset",s.modified.length)),s.removed.length&&a((0,o.tn)("Removed 1 column from the virtual dataset","Removed %s columns from the virtual dataset",s.removed.length)),s.added.length&&a((0,o.tn)("Added 1 new column to the virtual dataset","Added %s new columns to the virtual dataset",s.added.length)),s}async function u(e){var t,a;const n={datasource_type:e.type||e.datasource_type,database_name:(null==(t=e.database)?void 0:t.database_name)||(null==(a=e.database)?void 0:a.name),catalog_name:e.catalog,schema_name:e.schema,table_name:e.table_name,normalize_columns:e.normalize_columns,always_filter_main_dttm:e.always_filter_main_dttm};Object.entries(n).forEach((([e,t])=>{void 0===t&&(n[e]=null)}));const i=`/datasource/external_metadata_by_name/?q=${l().encode_uri(n)}`,{json:o}=await r.A.get({endpoint:i});return o}},67940:(e,t,a)=>{a.d(t,{D:()=>k,X:()=>M});var n=a(96540),i=a(25946),o=a(95579),r=a(96453),s=a(35742),l=a(51436),d=a(50217),c=a(85861),u=a(46920),m=a(50500),h=a(85183),p=a(27023),_=a(17444),g=a(90868),y=a(74261),f=a(5261),v=a(53365),b=a(2445);const w=(0,o.t)("Warning! Changing the dataset may break the chart if the metadata does not exist."),x=(0,o.t)("Changing the dataset may break the chart if the chart relies on columns or metadata that does not exist in the target dataset"),S=(0,r.I4)(c.Ay)`
  .antd5-modal-body {
    display: flex;
    flex-direction: column;
  }
`,A=r.I4.div`
  .btn-container {
    display: flex;
    justify-content: flex-end;
    padding: 0px 15px;
    margin: 10px 0 0 0;
  }

  .confirm-modal-container {
    margin: 9px;
  }
`,C=r.I4.span`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.dark1};
  &: hover {
    color: ${({theme:e})=>e.colors.primary.dark2};
  }
`,k=(0,f.Ay)((({addDangerToast:e,addSuccessToast:t,onChange:a,onDatasourceSave:r,onHide:c,show:f})=>{const[k,Y]=(0,n.useState)(void 0),[D,T]=(0,n.useState)(0),[F,H]=(0,n.useState)(y.Hu),[B,z]=(0,n.useState)(!1),[N,P]=(0,n.useState)(),E=(0,n.useRef)(null),{state:{loading:I,resourceCollection:M,resourceCount:O},fetchData:R}=(0,m.RU)("dataset",(0,o.t)("dataset"),e),$=(0,n.useCallback)((e=>{z(!0),P(e)}),[]),j={pageIndex:D,pageSize:y.md,filters:[],sortBy:F};(0,h.sv)((()=>{R({...j,...k&&{filters:[{id:"table_name",operator:"ct",value:k}]}})}),p.Qs,[k,D,F]),(0,n.useEffect)((()=>{f&&(async()=>{setTimeout((()=>{var e;return null==E||null==(e=E.current)?void 0:e.focus()}),200)})()}),[e,R,a,r,c,$,f]);const q=[{Cell:({row:{original:e}})=>(0,b.Y)(C,{role:"button",tabIndex:0,onClick:()=>$({type:"table",...e}),children:null==e?void 0:e.table_name}),Header:(0,o.t)("Name"),accessor:"table_name"},{Header:(0,o.t)("Type"),accessor:"kind",disableSortBy:!0},{Header:(0,o.t)("Schema"),accessor:"schema"},{Header:(0,o.t)("Connection"),accessor:"database.database_name",disableSortBy:!0},{Cell:({row:{original:{owners:e=[]}}})=>(0,b.Y)(v.A,{users:e}),Header:(0,o.t)("Owners"),id:"owners",disableSortBy:!0}];return(0,b.Y)(S,{show:f,onHide:c,responsive:!0,title:(0,o.t)("Swap dataset"),width:B?"432px":"",height:B?"auto":"540px",hideFooter:!B,footer:(0,b.Y)(b.FK,{children:B&&(0,b.Y)(A,{children:(0,b.FD)("div",{className:"btn-container",children:[(0,b.Y)(u.A,{onClick:()=>{z(!1)},children:(0,o.t)("Cancel")}),(0,b.Y)(u.A,{className:"proceed-btn",buttonStyle:"primary",onClick:()=>{s.A.get({endpoint:`/api/v1/dataset/${null==N?void 0:N.id}`}).then((({json:e})=>{e.result.type="table",r(e.result),a(`${null==N?void 0:N.id}__table`)})).catch((t=>{(0,l.h4)(t).then((({error:t,message:a})=>{const n=t?t.error||t.statusText||t:a;e(n)}))})),c(),t((0,o.t)("Successfully changed dataset!"))},children:(0,o.t)("Proceed")})]})})}),children:(0,b.FD)(b.FK,{children:[!B&&(0,b.FD)(b.FK,{children:[(0,b.Y)(i.A,{roomBelow:!0,type:"warning",css:e=>({marginBottom:4*e.gridUnit}),message:(0,b.FD)(b.FK,{children:[(0,b.Y)("strong",{children:(0,o.t)("Warning!")})," ",x]})}),(0,b.Y)(g.pd,{ref:E,type:"text",value:k,placeholder:(0,o.t)("Search / Filter"),onChange:e=>{var t;const a=null!=(t=e.target.value)?t:"";Y(a),T(0)}}),I&&(0,b.Y)(_.A,{}),!I&&(0,b.Y)(d.A,{columns:q,data:M,pageSize:y.md,initialPageIndex:D,initialSortBy:F,totalCount:O,onServerPagination:e=>{T(e.pageIndex),e.sortBy&&H(e.sortBy.length>0?e.sortBy:y.Hu)},className:"table-condensed",emptyWrapperType:d.V.Small,serverPagination:!0,isPaginationSticky:!0,scrollTable:!0})]}),B&&(0,b.Y)(b.FK,{children:w})]})})}));var Y=a(61225),D=a(13270),T=a(17437),F=a(16294),H=a(49262),B=a(79427),z=a(60130),N=a(11816);const P=(0,H.A)((()=>Promise.all([a.e(8096),a.e(8700),a.e(9666),a.e(5423),a.e(6672),a.e(4132)]).then(a.bind(a,30057)))),E=(0,r.I4)(c.Ay)`
  .modal-content {
    height: 900px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .modal-header {
    flex: 0 1 auto;
  }
  .modal-body {
    flex: 1 1 auto;
    overflow: auto;
  }

  .modal-footer {
    flex: 0 1 auto;
  }
`;function I(e){const t=null!=e&&e.certified_by||null!=e&&e.certification_details?{certified_by:null==e?void 0:e.certified_by,details:null==e?void 0:e.certification_details}:void 0;return JSON.stringify({certification:t,warning_markdown:null==e?void 0:e.warning_markdown})}const M=(0,f.Ay)((({addSuccessToast:e,addDangerToast:t,datasource:a,onDatasourceSave:d,onHide:m,show:h})=>{const p=(0,r.DP)(),_=(0,Y.wA)(),[g,y]=(0,n.useState)(a),f=(0,Y.d4)((e=>{var t;return null==(t=e.common)?void 0:t.currencies})),[v,w]=(0,n.useState)([]),[x,S]=(0,n.useState)(!1),[A,C]=(0,n.useState)(!1),k=(0,n.useRef)(null),[H,M]=c.Ay.useModal(),O=e=>{var t,a,n,i,o;return{table_name:e.table_name,database_id:null==(t=e.database)?void 0:t.id,sql:e.sql,filter_select_enabled:e.filter_select_enabled,fetch_values_predicate:e.fetch_values_predicate,schema:(null==(a=e.tableSelector)?void 0:a.schema)||(null==(n=e.databaseSelector)?void 0:n.schema)||e.schema,description:e.description,main_dttm_col:e.main_dttm_col,normalize_columns:e.normalize_columns,always_filter_main_dttm:e.always_filter_main_dttm,offset:e.offset,default_endpoint:e.default_endpoint,cache_timeout:""===e.cache_timeout?null:e.cache_timeout,is_sqllab_view:e.is_sqllab_view,template_params:e.template_params,extra:e.extra,is_managed_externally:e.is_managed_externally,external_url:e.external_url,metrics:null==e||null==(i=e.metrics)?void 0:i.map((e=>{const t={expression:e.expression,description:e.description,metric_name:e.metric_name,metric_type:e.metric_type,d3format:e.d3format||null,currency:(0,D.A)(e.currency)?JSON.stringify(e.currency):null,verbose_name:e.verbose_name,warning_text:e.warning_text,uuid:e.uuid,extra:I(e)};return Number.isNaN(Number(e.id))||(t.id=e.id),t})),columns:null==e||null==(o=e.columns)?void 0:o.map((e=>({id:"number"==typeof e.id?e.id:void 0,column_name:e.column_name,type:e.type,advanced_data_type:e.advanced_data_type,verbose_name:e.verbose_name,description:e.description,expression:e.expression,filterable:e.filterable,groupby:e.groupby,is_active:e.is_active,is_dttm:e.is_dttm,python_date_format:e.python_date_format||null,uuid:e.uuid,extra:I(e)}))),owners:e.owners.map((e=>e.value||e.id))}},R=async()=>{S(!0);try{if(await s.A.put({endpoint:`/api/v1/dataset/${g.id}`,jsonPayload:O(g)}),a.sql!==g.sql){_((0,z.startMetaDataLoading)());try{const t=await(0,N.m0)(g),a=(0,N.Dy)(g.columns,t,e);g.columns=a.finalColumns,_((0,z.syncDatasourceMetadata)(g)),_((0,z.stopMetaDataLoading)()),e((0,o.t)("Metadata has been synced"))}catch(e){_((0,z.stopMetaDataLoading)()),t((0,o.t)("An error has occurred while syncing virtual dataset columns"))}await s.A.put({endpoint:`/api/v1/dataset/${g.id}`,jsonPayload:O(g)})}const{json:n}=await s.A.get({endpoint:`/api/v1/dataset/${null==g?void 0:g.id}`});e((0,o.t)("The dataset has been saved")),n.result.type="table",d({...n.result,owners:g.owners}),m()}catch(e){var n;S(!1);const t=await(0,l.h4)(e);let a,i;null!=t&&null!=(n=t.errors)&&n.length?a=t.errors[0]:"string"==typeof t.error&&(i=t.error),H.error({title:(0,o.t)("Error saving dataset"),okButtonProps:{danger:!0,className:"btn-danger"},content:(0,b.Y)(B.A,{error:a,source:"crud",fallback:i})})}};return(0,b.FD)(E,{show:h,onHide:m,title:(0,b.FD)("span",{children:[(0,b.Y)(F.A.EditOutlined,{iconSize:"l",css:T.AH`
              margin: auto ${2*p.gridUnit}px auto 0;
            `}),(0,o.t)("Edit Dataset "),(0,b.Y)("strong",{children:g.table_name})]}),maskClosable:!A,footer:(0,b.FD)(b.FK,{children:[(0,b.Y)(u.A,{buttonSize:"small",className:"m-r-5",onClick:m,children:(0,o.t)("Cancel")}),(0,b.Y)(u.A,{buttonSize:"small",buttonStyle:"primary",onClick:()=>{k.current=H.confirm({title:(0,o.t)("Confirm save"),content:(0,b.FD)("div",{children:[(0,b.Y)(i.A,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),type:"warning",showIcon:!0,message:(0,o.t)("The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.")}),(0,o.t)("Are you sure you want to save and apply changes?")]}),onOk:R,icon:null,okText:(0,o.t)("OK"),cancelText:(0,o.t)("Cancel")})},disabled:x||v.length>0||g.is_managed_externally,tooltip:g.is_managed_externally?(0,o.t)("This dataset is managed externally, and can't be edited in Superset"):"",children:(0,o.t)("Save")})]}),responsive:!0,children:[(0,b.Y)(P,{showLoadingForImport:!0,height:500,datasource:g,onChange:(e,t)=>{y({...e,metrics:null==e?void 0:e.metrics.map((e=>({...e,is_certified:(null==e?void 0:e.certified_by)||(null==e?void 0:e.certification_details)})))}),w(t)},setIsEditing:C,currencies:f}),M]})}))},74261:(e,t,a)=>{a.d(t,{Hu:()=>o,R6:()=>s,md:()=>i,ry:()=>r});var n=a(95579);const i=25,o=[{id:"changed_on_delta_humanized",desc:!0}],r=(0,n.t)('The passwords for the databases below are needed in order to import them together with the datasets. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),s=(0,n.t)("You are importing one or more datasets that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?")},78704:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(17437),i=a(96453),o=a(16784),r=a(16294),s=a(19129),l=a(2445);const d=function({warningMarkdown:e,size:t,marginRight:a}){const d=(0,i.DP)();return(0,l.Y)(s.m_,{id:"warning-tooltip",title:(0,l.Y)(o.A,{source:e}),children:(0,l.Y)(r.A.WarningOutlined,{iconColor:d.colors.warning.base,iconSize:t,css:(0,n.AH)({marginRight:null!=a?a:2*d.gridUnit},"","")})})}}}]);