"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[576],{25564:(t,e,o)=>{o.d(e,{A:()=>c});var n=o(68961),a=o.n(n),r=o(4523),l=o(12619),i=o(49443);const s={console,_:r.Ay,colors:i,d3array:l};function c(t,e,o){const n={},r=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[r]={};const l=`${r}=${t}`,i={...s,...e};Object.keys(i).forEach((t=>{n[t]=i[t]}));try{return a().runInNewContext(l,n,o),n[r]}catch(t){return()=>t}}},32548:(t,e,o)=>{o.d(e,{A:()=>a});var n=o(2445);const a=({label:t,value:e})=>(0,n.FD)("div",{children:[t,(0,n.Y)("strong",{children:e})]})},41857:(t,e,o)=>{o.d(e,{T:()=>r,g:()=>s});var n=o(12619),a=o(25564);function r(t,e,o,n){const r=t;let l,i,s=o;return r.js_tooltip&&(s=(0,a.A)(r.js_tooltip)),s&&(l=t=>(t.picked?e({content:s(t),x:t.x,y:t.y}):e(null),!0)),r.js_onclick_href?i=t=>{const e=(0,a.A)(r.js_onclick_href)(t);return window.open(e),!0}:r.table_filter&&void 0!==n&&(i=t=>(n(t.object[r.line_column]),!0)),{onClick:i,onHover:l,pickable:Boolean(l)}}const l={p1:.01,p5:.05,p95:.95,p99:.99},i={sum:n.sum,min:n.min,max:n.max,mean:n.mean,median:n.median,variance:n.variance,deviation:n.deviation};function s(t="sum",e=null){if("count"===t)return t=>t.length;let o;if(t in l)o=(o,a)=>{let r;return r=e?o.sort(((t,o)=>(0,n.ascending)(e(t),e(o)))):o.sort(n.ascending),(0,n.quantile)(r,l[t],a)};else{if(!(t in i))throw new Error(`Unsupported aggregation type: ${t}`);o=i[t]}return e?t=>o(t.map((t=>e(t)))):t=>o(t)}},47823:(t,e,o)=>{o.d(e,{c:()=>v,y:()=>b});var n=o(2404),a=o.n(n),r=o(96540),l=o(83505),i=o(70957),s=o(94963),c=o(66671),u=o(49443),d=o(25564),p=o(95490),h=o(2445);const{getScale:f}=s;function g(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},n=[o.r,o.g,o.b,255*o.a],a=t.color_scheme,r=f(a),l={};return e.forEach((e=>{if(null!=e.cat_color&&!l.hasOwnProperty(e.cat_color)){let a;a=t.dimension?(0,u.hexToRGB)(r(e.cat_color,t.sliceId),255*o.a):n,l[e.cat_color]={color:a,enabled:!0}}})),l}const m=t=>{const e=(0,r.useRef)(null),o=(0,r.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,p.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[n,a]=(0,r.useState)(g(t.formData,t.payload.data.features||[])),[l,s]=(0,r.useState)(t.payload.form_data),[m,y]=(0,r.useState)(o());(0,r.useEffect)((()=>{if(t.payload.form_data!==l){const e=t.payload.data.features||[],n=g(t.formData,e);y(o()),s(t.payload.form_data),a(n)}}),[o,t,l]);const b=(0,r.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),v=(0,r.useCallback)(((t,e)=>{const o=e.color_picker||{r:0,g:0,b:0,a:1},n=e.color_scheme,a=f(n);return t.map((t=>{let n;return e.dimension?(n=(0,u.hexToRGB)(a(t.cat_color,e.sliceId),255*o.a),{...t,color:n}):t}))}),[]),w=(0,r.useCallback)((()=>{const{getLayer:e,payload:o,formData:a,onAddFilter:r}=t;let l=o.data.features?[...o.data.features]:[];return l=v(l,a),a.js_data_mutator&&(l=(0,d.A)(a.js_data_mutator)(l)),a.dimension&&(l=l.filter((t=>{var e;return null==(e=n[t.cat_color])?void 0:e.enabled}))),[e(a,{...o,data:{...o.data,features:l}},r,b,t.datasource)]}),[v,n,t,b]),x=(0,r.useCallback)((t=>{const e=n[t],o={...n,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),a(o)}),[n]),k=(0,r.useCallback)((t=>{const e={...n};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,a(e)}),[n]);return(0,h.FD)("div",{style:{position:"relative"},children:[(0,h.Y)(i.S,{ref:e,viewport:m,layers:w(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,h.Y)(c.A,{forceCategorical:!0,categories:n,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:k,toggleCategory:x})]})},y=(0,r.memo)(m);function b(t,e){return(0,r.memo)((o=>{const n=(0,r.useRef)(),s=(0,l.Z)(o.formData),c=(0,l.Z)(o.payload),[u,d]=(0,r.useState)((()=>{const{width:t,height:n,formData:a}=o;return a.autozoom?(0,p.A)(o.viewport,{width:t,height:n,points:e(o.payload.data.features)}):o.viewport})()),f=(0,r.useCallback)((t=>{const{current:e}=n;e&&(null==e||e.setTooltip(t))}),[]),g=(0,r.useCallback)((e=>{const{formData:o,payload:n,onAddFilter:a}=e;return t(o,n,a,f)}),[f]),[m,y]=(0,r.useState)(g(o));(0,r.useEffect)((()=>{const t={...s,viewport:null},e={...o.formData,viewport:null};a()(t,e)&&c===o.payload||y(g(o))}),[g,s,c,o]);const{formData:b,payload:v,setControlValue:w,height:x,width:k}=o;return(0,h.Y)(i.S,{ref:n,mapboxApiAccessToken:v.data.mapboxApiKey,viewport:u,layers:[m],mapStyle:b.mapbox_style,setControlValue:w,width:k,height:x,onViewportChange:d})}))}function v(t,e){return function(o){const{datasource:n,formData:a,height:r,payload:l,setControlValue:i,viewport:s,width:c}=o;return(0,h.Y)(y,{datasource:n,formData:a,mapboxApiKey:l.data.mapboxApiKey,setControlValue:i,viewport:s,getLayer:t,payload:l,getPoints:e,width:c,height:r})}}},49443:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>a});var n=o(2117);function a(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:a,b:r}=(0,n.Qh)(t);return[o,a,r,e]}},66671:(t,e,o)=>{o.d(e,{A:()=>u});var n=o(96540),a=o(96453),r=o(32142),l=o(2445);const i=a.I4.div`
  ${({theme:t})=>`\n    font-size: ${t.typography.sizes.s}px;\n    position: absolute;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: 0 0 ${t.gridUnit}px ${t.colors.grayscale.light2};\n    margin: ${6*t.gridUnit}px;\n    padding: ${3*t.gridUnit}px ${5*t.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colors.grayscale.base};\n        text-decoration: none;\n        padding: ${t.gridUnit}px 0;\n\n        & span {\n          margin-right: ${t.gridUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:n={},toggleCategory:a=()=>{},showSingleCategory:c=()=>{}})=>{const u=o=>{if(!t||e)return o;const n=parseFloat(o);return(0,r.ZV)(t,n)},d=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return u(t[0])+s+u(t[1])}return u(e)};if(0===Object.keys(n).length||null===o)return null;const p=Object.entries(n).map((([t,e])=>{var o;const n={color:`rgba(${null==(o=e.color)?void 0:o.join(", ")})`},r=e.enabled?"◼":"◻";return(0,l.Y)("li",{children:(0,l.FD)("a",{href:"#",role:"button",onClick:()=>a(t),onDoubleClick:()=>c(t),children:[(0,l.Y)("span",{style:n,children:r})," ",d(t)]})},t)})),h="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",f="r"===(null==o?void 0:o.charAt(1))?"right":"left",g={position:"absolute",[h]:"0px",[f]:"10px"};return(0,l.Y)(i,{className:"dupa",style:g,children:(0,l.Y)("ul",{children:p})})},u=(0,n.memo)(c)},70957:(t,e,o)=>{o.d(e,{S:()=>g});var n=o(2404),a=o.n(n),r=o(96540),l=o(88813),i=o(82487),s=o(83505),c=o(96453),u=o(58642),d=o(2445);const p=c.I4.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.gridUnit}px;\n    margin: ${2*t.gridUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function h(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:a}=e,r="string"==typeof a?(0,u.nn)(a):a;return(0,d.Y)(p,{top:n,left:o,children:r})}const f=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const[o,n]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[p,f]=(0,r.useState)(t.viewport),g=(0,s.Z)(t.viewport);(0,r.useImperativeHandle)(e,(()=>({setTooltip:n})),[]);const m=(0,r.useCallback)((()=>{if(c&&Date.now()-c>250){const e=t.setControlValue;e&&e("viewport",p),u(null)}}),[c,t.setControlValue,p]);(0,r.useEffect)((()=>{const t=setInterval(m,250);return clearInterval(t)}),[m]),(0,r.useEffect)((()=>{a()(t.viewport,g)||f(t.viewport)}),[g,t.viewport]);const y=(0,r.useCallback)((({viewState:t})=>{f(t),u(Date.now())}),[]),b=(0,r.useCallback)((()=>t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers),[t.layers]),{children:v=null,height:w,width:x}=t;return(0,d.FD)(d.FK,{children:[(0,d.FD)("div",{style:{position:"relative",width:x,height:w},children:[(0,d.Y)(i.A,{controller:!0,width:x,height:w,layers:b(),viewState:p,onViewStateChange:y,children:(0,d.Y)(l.b,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})}),v]}),(0,d.Y)(h,{tooltip:o})]})}))),g=(0,c.I4)(f)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},83505:(t,e,o)=>{o.d(e,{Z:()=>a});var n=o(96540);function a(t,e){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{o.current=t}),[t]),o.current}},95490:(t,e,o)=>{o.d(e,{A:()=>s});var n=o(55016),a=o(12619);const r=[-90,90],l=[-180,180];function i([t,e],[o,n],a=.25){return t<e?[t,e]:[Math.max(o,t-a),Math.min(n,e+a)]}function s(t,{points:e,width:o,height:s,minExtent:c,maxZoom:u,offset:d,padding:p=20}){const{bearing:h,pitch:f}=t,g=function(t){const e=i((0,a.extent)(t,(t=>t[1])),r),o=i((0,a.extent)(t,(t=>t[0])),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Fe)({bounds:g,width:o,height:s,minExtent:c,maxZoom:u,offset:d,padding:p}),bearing:h,pitch:f}}catch(t){console.error("Could not fit viewport",t)}return t}}}]);